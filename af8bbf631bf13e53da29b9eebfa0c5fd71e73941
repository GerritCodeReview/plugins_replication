{
  "comments": [
    {
      "key": {
        "uuid": "c42ca6b3_01615747",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2019-09-24T08:30:54Z",
      "side": 1,
      "message": "nit: wrap this long line",
      "revId": "af8bbf631bf13e53da29b9eebfa0c5fd71e73941",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "07a9dec8_cbbaa401",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2019-09-24T08:46:06Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c42ca6b3_01615747",
      "revId": "af8bbf631bf13e53da29b9eebfa0c5fd71e73941",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c5798635_eb976018",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 12,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2019-09-24T08:30:54Z",
      "side": 1,
      "message": "Bug",
      "range": {
        "startLine": 12,
        "startChar": 0,
        "endLine": 12,
        "endChar": 7
      },
      "revId": "af8bbf631bf13e53da29b9eebfa0c5fd71e73941",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e98d3085_c30e6d8f",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 12,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2019-09-24T08:46:06Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "c5798635_eb976018",
      "range": {
        "startLine": 12,
        "startChar": 0,
        "endLine": 12,
        "endChar": 7
      },
      "revId": "af8bbf631bf13e53da29b9eebfa0c5fd71e73941",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5afb6e3a_40fb78b9",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 3
      },
      "lineNbr": 74,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-09-24T08:50:00Z",
      "side": 1,
      "message": "I see that that order of the fields here and in the constructor are not identical\nbut would still propose to move this line between below 77 or 78. Another reason\nis that this value is not injected and we normally first declare injected fields and\nthen the other fields.",
      "revId": "af8bbf631bf13e53da29b9eebfa0c5fd71e73941",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6beee71e_6dca021c",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 3
      },
      "lineNbr": 74,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2019-09-24T09:07:39Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "5afb6e3a_40fb78b9",
      "revId": "af8bbf631bf13e53da29b9eebfa0c5fd71e73941",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fbda0d80_d101d788",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 3
      },
      "lineNbr": 74,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-24T09:22:15Z",
      "side": 1,
      "message": "Why is this a queue? It should rather be a Set IMHO.\nIf the startup takes 30 secs and you receive 5 identical ref-update events on the same repo/ref, then you should only trigger 1 ref-update event.",
      "range": {
        "startLine": 74,
        "startChar": 16,
        "endLine": 74,
        "endChar": 21
      },
      "revId": "af8bbf631bf13e53da29b9eebfa0c5fd71e73941",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d3146114_f33e81e6",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 3
      },
      "lineNbr": 74,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-09-24T09:40:34Z",
      "side": 1,
      "message": "Luca see my comment about that below (line 185)",
      "parentUuid": "fbda0d80_d101d788",
      "range": {
        "startLine": 74,
        "startChar": 16,
        "endLine": 74,
        "endChar": 21
      },
      "revId": "af8bbf631bf13e53da29b9eebfa0c5fd71e73941",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e825793b_e7c1ae1e",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 3
      },
      "lineNbr": 74,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-24T09:48:34Z",
      "side": 1,
      "message": "\u003e Luca see my comment about that below (line 185)\n\nOh yes, we had the same thinking on that :-)\nBest to make it a Set in the first place.",
      "parentUuid": "d3146114_f33e81e6",
      "range": {
        "startLine": 74,
        "startChar": 16,
        "endLine": 74,
        "endChar": 21
      },
      "revId": "af8bbf631bf13e53da29b9eebfa0c5fd71e73941",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c5b72203_90f7308b",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 3
      },
      "lineNbr": 74,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2019-09-24T09:48:58Z",
      "side": 1,
      "message": "Without refactoring we have to keep GitReferenceUpdatedListener.Event and this class doesn\u0027t override equals and hashcode so using set is pointless for now.  Implementing it as a queue is just a simplest and most elegant way. To make sure that we are not triggering multiple events for the same repo I\u0027m using similar concept as in draining queue in stable-2.16, I have a set where I keep \"project name\":\"ref name pair\". In stable-2.16 we already have refactoring which enables us to keep this pair instead of Event instance.",
      "parentUuid": "fbda0d80_d101d788",
      "range": {
        "startLine": 74,
        "startChar": 16,
        "endLine": 74,
        "endChar": 21
      },
      "revId": "af8bbf631bf13e53da29b9eebfa0c5fd71e73941",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0a980f07_dcf4ab65",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 3
      },
      "lineNbr": 94,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-24T09:22:15Z",
      "side": 1,
      "message": "Why should be a concurrent linked queue? What type of concurrency are you expecting?",
      "range": {
        "startLine": 94,
        "startChar": 38,
        "endLine": 94,
        "endChar": 62
      },
      "revId": "af8bbf631bf13e53da29b9eebfa0c5fd71e73941",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2e16d821_c9cd1b0e",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 3
      },
      "lineNbr": 94,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-09-24T09:40:34Z",
      "side": 1,
      "message": "\u003e Why should be a concurrent linked queue? What type of concurrency are you expecting?\n\nfor example: two concurrent requests updating two git refs. In this case we would have\ntwo concurrent calls to the onGitReferenceUpdated method which will both update the beforeStartupEventsQueue",
      "parentUuid": "0a980f07_dcf4ab65",
      "range": {
        "startLine": 94,
        "startChar": 38,
        "endLine": 94,
        "endChar": 62
      },
      "revId": "af8bbf631bf13e53da29b9eebfa0c5fd71e73941",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ee2caab6_c7a59352",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 3
      },
      "lineNbr": 94,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-24T09:48:34Z",
      "side": 1,
      "message": "Fair enough, however in the replication plugin we typically synchronise all the incoming queueing. Having a synchronized() block would be good enough and won\u0027t be worse than the current concurrency we have at the moment.",
      "parentUuid": "2e16d821_c9cd1b0e",
      "range": {
        "startLine": 94,
        "startChar": 38,
        "endLine": 94,
        "endChar": 62
      },
      "revId": "af8bbf631bf13e53da29b9eebfa0c5fd71e73941",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a9ac2ae9_4efa88fc",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 3
      },
      "lineNbr": 138,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-09-24T08:50:00Z",
      "side": 1,
      "message": "replication",
      "range": {
        "startLine": 138,
        "startChar": 67,
        "endLine": 138,
        "endChar": 83
      },
      "revId": "af8bbf631bf13e53da29b9eebfa0c5fd71e73941",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2bba4ee7_0d88659a",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 3
      },
      "lineNbr": 138,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-09-24T08:50:00Z",
      "side": 1,
      "message": "postponed",
      "range": {
        "startLine": 138,
        "startChar": 87,
        "endLine": 138,
        "endChar": 95
      },
      "revId": "af8bbf631bf13e53da29b9eebfa0c5fd71e73941",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "57e005ed_886f9836",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 3
      },
      "lineNbr": 138,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2019-09-24T09:07:39Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a9ac2ae9_4efa88fc",
      "range": {
        "startLine": 138,
        "startChar": 67,
        "endLine": 138,
        "endChar": 83
      },
      "revId": "af8bbf631bf13e53da29b9eebfa0c5fd71e73941",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "97a65bb4_99fea897",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 3
      },
      "lineNbr": 138,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2019-09-24T09:07:39Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "2bba4ee7_0d88659a",
      "range": {
        "startLine": 138,
        "startChar": 87,
        "endLine": 138,
        "endChar": 95
      },
      "revId": "af8bbf631bf13e53da29b9eebfa0c5fd71e73941",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "587ab5fc_fca9ed0d",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 3
      },
      "lineNbr": 185,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-09-24T08:50:00Z",
      "side": 1,
      "message": "The fireBeforeStartupEvents method is called when this queue is up and running.\nHowever, here we call the onGitReferenceUpdated method which is a public method and\ncontains a check for the running flag. Once we are here we do not need this check again, right?\n\nFurther, because of this call you need to keep the whole GitReferenceUpdatedListener.Event objects in the beforeStartupEventsQueue and then here you need to collect the projections\nof the events onto the projectname:refname plane in order to avoid scheduling twice for the\nsame eventKey. The part of the onGitReferenceUpdated method only really needs the\n(projectname, refname) in order to schedule the replication. Therefore, we can keep\njust this pair in the beforeStartupEventsQueue (actually it should then become a Set in\norder to automatically filter out duplicates) and then we do not need the eventsReplayed\nhere any more.",
      "revId": "af8bbf631bf13e53da29b9eebfa0c5fd71e73941",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "97119e07_b125c6e9",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 3
      },
      "lineNbr": 185,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2019-09-24T09:07:39Z",
      "side": 1,
      "message": "Yes you are right I saw that already in stable-2.16 for draining queue. I wanted to keep my change minimal that\u0027s why I\u0027ve decided to not change signature of onGitReferenceUpdated(currently it accepts Event object). If you are fine with doing some refactoring I\u0027m happy to do that but have in mind that it\u0027s already done in stable-2.16 so merge will be more complex and probably my refactoring will be discarded anyway.",
      "parentUuid": "587ab5fc_fca9ed0d",
      "revId": "af8bbf631bf13e53da29b9eebfa0c5fd71e73941",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "aa8366bd_0ff75232",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 3
      },
      "lineNbr": 185,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-09-24T09:14:34Z",
      "side": 1,
      "message": "I see... the code kind of looked familiar to me already :-)\n\nWhat about accepting this code as-is and then performing the necessary refactoring and improvement?",
      "parentUuid": "97119e07_b125c6e9",
      "revId": "af8bbf631bf13e53da29b9eebfa0c5fd71e73941",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4f7aeb76_a84183f1",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 3
      },
      "lineNbr": 185,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2019-09-24T09:18:48Z",
      "side": 1,
      "message": "Sounds great to me :)",
      "parentUuid": "aa8366bd_0ff75232",
      "revId": "af8bbf631bf13e53da29b9eebfa0c5fd71e73941",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "366f7366_8bf0ca20",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 3
      },
      "lineNbr": 185,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-24T09:22:15Z",
      "side": 1,
      "message": "I would avoid refactoring the code in a stable branch: we should keep a consistent approach and to bug-fixing on stable branches and refactoring on master.\n\nWorst case, refactoring should be done on the latest stable (stable-3.0) to avoid all the potential merging issues upstream.",
      "parentUuid": "aa8366bd_0ff75232",
      "revId": "af8bbf631bf13e53da29b9eebfa0c5fd71e73941",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c070b683_df34a0de",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 3
      },
      "lineNbr": 185,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2019-09-24T09:48:58Z",
      "side": 1,
      "message": "Yes and a lot of work mentioned before is done together with fixing the issue for draining events",
      "parentUuid": "366f7366_8bf0ca20",
      "revId": "af8bbf631bf13e53da29b9eebfa0c5fd71e73941",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}