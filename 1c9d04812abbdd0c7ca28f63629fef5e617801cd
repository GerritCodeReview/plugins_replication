{
  "comments": [
    {
      "key": {
        "uuid": "4af3c314_c8d909fc",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/AutoReloadConfigDecorator.java",
        "patchSetId": 4
      },
      "lineNbr": 145,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2019-09-11T17:15:39Z",
      "side": 1,
      "message": "I think I understand the fix to follow this change, but I am not sure if this description explains well enough what\u0027s the issue with the shutdown. Perhaps we can find a way to reword it so that is more clear?\n\n- \"...because it may need to wait for pending events to complete.\"\nWhy is this a problem? is it because the potential deadlocking? if so, we could coalesce the two sentences (the P.S. at the bottom) and explain who is causing the concurrency and why that might occur.\n\n- This do/while could potentially go on endlessly. Do we have any timeout to prevent this? Should we make it explicit in the comment/signature of this method?\n\n- Configuration changing during shutdown is kind of an edge case isn\u0027t?\nWe could add a log line to facilitate understanding when that happens.",
      "range": {
        "startLine": 137,
        "startChar": 1,
        "endLine": 145,
        "endChar": 5
      },
      "revId": "1c9d04812abbdd0c7ca28f63629fef5e617801cd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d02cb844_d2907153",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/AutoReloadConfigDecorator.java",
        "patchSetId": 4
      },
      "lineNbr": 145,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-11T21:09:31Z",
      "side": 1,
      "message": "\u003e I think I understand the fix to follow this change, but I am not sure if this description explains well enough what\u0027s the issue with the shutdown. Perhaps we can find a way to reword it so that is more clear?\n\nWhen you have a synchronized method, it should not refer again to the same or other methods of the same object, otherwise we have a deadlock.\n\nThe shutdown() method, instead, may wait for the replication queue to drain and thus *cannot* hold the lock for a long time, otherwise the deadlock would be almost certain.\n\nDoes that explain?\n\nP.S. The whole conversation is traced in NoteDb as it accessible, I wouldn\u0027t add too much level of details in the comment IMHO.\n\n\u003e - \"...because it may need to wait for pending events to complete.\"\n\u003e Why is this a problem? is it because the potential deadlocking? if so, we could coalesce the two sentences (the P.S. at the bottom) and explain who is causing the concurrency and why that might occur.\n\nSee above: I believe this conversation would be enough to understand the conditions of a deadlock.\n\n\u003e - This do/while could potentially go on endlessly. Do we have any timeout to prevent this? Should we make it explicit in the comment/signature of this method?\n\nGood catch, I actually believe we should not reload the configuration at all whilst in \"shutting down\" mode. I\u0027ll do that in a follow-up change.\n\n\u003e - Configuration changing during shutdown is kind of an edge case isn\u0027t?\n\u003e We could add a log line to facilitate understanding when that happens.\n\nSee above: I prefer to prevent that situation to happen and just log that we do not reload the configuration because the plugin is about to shut down.",
      "parentUuid": "4af3c314_c8d909fc",
      "range": {
        "startLine": 137,
        "startChar": 1,
        "endLine": 145,
        "endChar": 5
      },
      "revId": "1c9d04812abbdd0c7ca28f63629fef5e617801cd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c908ee07_d650e97a",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/AutoReloadConfigDecorator.java",
        "patchSetId": 4
      },
      "lineNbr": 145,
      "author": {
        "id": 1072905
      },
      "writtenOn": "2019-09-11T21:44:57Z",
      "side": 1,
      "message": "yep, makes sense and this conversation is now traceable too.\nI am happy with this change",
      "parentUuid": "d02cb844_d2907153",
      "range": {
        "startLine": 137,
        "startChar": 1,
        "endLine": 145,
        "endChar": 5
      },
      "revId": "1c9d04812abbdd0c7ca28f63629fef5e617801cd",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}