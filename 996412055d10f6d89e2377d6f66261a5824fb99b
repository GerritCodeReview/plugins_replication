{
  "comments": [
    {
      "key": {
        "uuid": "aefb44ac_c3cfaac9",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 7,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-07-15T14:02:47Z",
      "side": 1,
      "message": "Before this change we really stored the git-ref-updated events\nand not the replication events.\n\nReplication tasks are generated based on the git-ref-updated events and the replication.config.",
      "range": {
        "startLine": 7,
        "startChar": 19,
        "endLine": 7,
        "endChar": 48
      },
      "revId": "996412055d10f6d89e2377d6f66261a5824fb99b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a256efb6_15ee09c5",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 7,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-08-25T10:12:25Z",
      "side": 1,
      "message": "True, let me clarify this in the commit message.",
      "parentUuid": "aefb44ac_c3cfaac9",
      "range": {
        "startLine": 7,
        "startChar": 19,
        "endLine": 7,
        "endChar": 48
      },
      "tag": "autogenerated:gerrit:newWipPatchSet",
      "revId": "996412055d10f6d89e2377d6f66261a5824fb99b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dd8ef30c_771c0166",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 7,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-08-25T10:17:23Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a256efb6_15ee09c5",
      "range": {
        "startLine": 7,
        "startChar": 19,
        "endLine": 7,
        "endChar": 48
      },
      "tag": "autogenerated:gerrit:newWipPatchSet",
      "revId": "996412055d10f6d89e2377d6f66261a5824fb99b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "62547e76_b9a155b2",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 9,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-07-15T14:02:47Z",
      "side": 1,
      "message": "We should also align the semantics. This change proposes to store the replication tasks... which means that the EventsStorage should\nalso be renamed to ReplicationTaskStorage or something similar.",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 9,
        "endChar": 78
      },
      "revId": "996412055d10f6d89e2377d6f66261a5824fb99b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3b5fbebe_27cc4c2c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 9,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-08-25T10:12:25Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "62547e76_b9a155b2",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 9,
        "endChar": 78
      },
      "tag": "autogenerated:gerrit:newWipPatchSet",
      "revId": "996412055d10f6d89e2377d6f66261a5824fb99b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4c70fbd9_2452a520",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/Destination.java",
        "patchSetId": 6
      },
      "lineNbr": 380,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-07-15T14:02:47Z",
      "side": 1,
      "message": "Replication events were already persisted from the GitReferenceUpdateListener implementation,\nwhich is the ReplicationQueue.onGitReferenceUpdated.\n\nWhy do we need to persist events also from here?",
      "revId": "996412055d10f6d89e2377d6f66261a5824fb99b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "296fcfc3_82a547c5",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/Destination.java",
        "patchSetId": 6
      },
      "lineNbr": 380,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-08-25T10:46:24Z",
      "side": 1,
      "message": "Yes, because the granularity is different: previously we persisted one event per ref-update whilst now we do persist replication tasks and thus they are 1:1 with the destination and the endpoint URL.",
      "parentUuid": "4c70fbd9_2452a520",
      "tag": "autogenerated:gerrit:newWipPatchSet",
      "revId": "996412055d10f6d89e2377d6f66261a5824fb99b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4e86aaa3_fa20681f",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/EventsDirectoryProvider.java",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-07-15T14:02:47Z",
      "side": 1,
      "message": "Introducing this provider is unrelated and unnecessary for the purpose of this change.\nPlease keep this change minimal and move this into another change.",
      "revId": "996412055d10f6d89e2377d6f66261a5824fb99b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "22bbfbae_e3fdd7ab",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/EventsDirectoryProvider.java",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-08-25T10:46:24Z",
      "side": 1,
      "message": "Agreed, I\u0027ve removed that part.",
      "parentUuid": "4e86aaa3_fa20681f",
      "tag": "autogenerated:gerrit:newWipPatchSet",
      "revId": "996412055d10f6d89e2377d6f66261a5824fb99b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ba554419_b3ab115e",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/EventsStorage.java",
        "patchSetId": 6
      },
      "lineNbr": 60,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-07-15T14:02:47Z",
      "side": 1,
      "message": "I don\u0027t like that these refactorings are combined with this change. What should\nhave been just one line delta:\n\n  + r.uri \u003d uri.toASCIIString();\n\nIs now 12 changed lines. If this is necessary then please do it before or after this change.",
      "revId": "996412055d10f6d89e2377d6f66261a5824fb99b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "145551f3_102bea13",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/EventsStorage.java",
        "patchSetId": 6
      },
      "lineNbr": 60,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-08-25T10:46:24Z",
      "side": 1,
      "message": "Agreed, I\u0027ll minimize the changes and postpone the refactoring.",
      "parentUuid": "ba554419_b3ab115e",
      "tag": "autogenerated:gerrit:newWipPatchSet",
      "revId": "996412055d10f6d89e2377d6f66261a5824fb99b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6caba1af_5f76aeed",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/EventsStorage.java",
        "patchSetId": 6
      },
      "lineNbr": 60,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-08-25T12:43:51Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "145551f3_102bea13",
      "tag": "autogenerated:gerrit:newWipPatchSet",
      "revId": "996412055d10f6d89e2377d6f66261a5824fb99b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2e8c4741_fa151856",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/EventsStorage.java",
        "patchSetId": 6
      },
      "lineNbr": 68,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-07-15T14:02:47Z",
      "side": 1,
      "message": "What are there leading/trailing stars good for? :-)",
      "range": {
        "startLine": 68,
        "startChar": 28,
        "endLine": 68,
        "endChar": 38
      },
      "revId": "996412055d10f6d89e2377d6f66261a5824fb99b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "62bad0c7_4a64f716",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/EventsStorage.java",
        "patchSetId": 6
      },
      "lineNbr": 68,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-08-25T10:46:24Z",
      "side": 1,
      "message": "Just noticing the string more easily from a visual inspection: I can remove them anyway, they are just debugging info.",
      "parentUuid": "2e8c4741_fa151856",
      "range": {
        "startLine": 68,
        "startChar": 28,
        "endLine": 68,
        "endChar": 38
      },
      "tag": "autogenerated:gerrit:newWipPatchSet",
      "revId": "996412055d10f6d89e2377d6f66261a5824fb99b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c27b0d64_c640e869",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/EventsStorage.java",
        "patchSetId": 6
      },
      "lineNbr": 76,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-07-15T14:02:47Z",
      "side": 1,
      "message": "In the base version we expected the event key here and I believe this was a good design:\n* the caller doesn\u0027t have to know how event key is built (which components)\n* the persist method returns the eventKey and the caller was supposed to keep it and use\nfor calling the delete method\n\nIn this change, the return value of the persist is ignored.",
      "range": {
        "startLine": 76,
        "startChar": 21,
        "endLine": 76,
        "endChar": 59
      },
      "revId": "996412055d10f6d89e2377d6f66261a5824fb99b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "da779006_f64651c7",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/EventsStorage.java",
        "patchSetId": 6
      },
      "lineNbr": 76,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-08-25T10:46:24Z",
      "side": 1,
      "message": "\u003e In the base version we expected the event key here and I believe this was a good design:\n\u003e * the caller doesn\u0027t have to know how event key is built (which components)\n\nThe caller has the following info: the project, the ref and the URI and needs to tell that that operation has been completed and the associated stored task should be removed.\n\nI believe that giving the responsibility to the caller to understand how the persistence of those events is implemented is breaking the API contract and exposes the underlying implementation details, which isn\u0027t a good design principle.\n\nStoring the individual replication key values with the PushOp is problematic for two reasons:\n\na) Insert into the PushOp knowledge that the event is stored somewhere, which isn\u0027t its responsibility to know.\nb) Doesn\u0027t work when we need to remove all the replication tasks on disk happening because of a massive replication on a repository for all refs. How do we know all the keys associated to all refs of one repo if we don\u0027t have the PushOp operations for them?\n\n\u003e * the persist method returns the eventKey and the caller was supposed to keep it and use\n\u003e for calling the delete method\n\nSure, but involves more work and changes on the other parts of the code and won\u0027t work\nanyway when pushing all refs of an existing repo.",
      "parentUuid": "c27b0d64_c640e869",
      "range": {
        "startLine": 76,
        "startChar": 21,
        "endLine": 76,
        "endChar": 59
      },
      "tag": "autogenerated:gerrit:newWipPatchSet",
      "revId": "996412055d10f6d89e2377d6f66261a5824fb99b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}