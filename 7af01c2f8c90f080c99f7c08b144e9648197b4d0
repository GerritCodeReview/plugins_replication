{
  "comments": [
    {
      "key": {
        "uuid": "9b4da2c6_b671f012",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 6
      },
      "lineNbr": 57,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2019-10-23T18:52:08Z",
      "side": 1,
      "message": "No need to code the storage type in the name, beforeStartupEvents should do.",
      "range": {
        "startLine": 57,
        "startChar": 43,
        "endLine": 57,
        "endChar": 65
      },
      "revId": "7af01c2f8c90f080c99f7c08b144e9648197b4d0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f6caf418_c7d6d050",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 6
      },
      "lineNbr": 79,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2019-10-23T18:52:08Z",
      "side": 1,
      "message": "Aren\u0027t they also being persisted here? Which begs the question, why do we need to store them in memory also if we are just going to dump the whole persisted store into memory after startup anyway?",
      "revId": "7af01c2f8c90f080c99f7c08b144e9648197b4d0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dfc75455_8633b0e1",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 6
      },
      "lineNbr": 79,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2019-10-26T03:13:58Z",
      "side": 1,
      "message": "Those events are not in persisted store. This code was implemented in that way that during the startup it was accepting new events and just dropping them. We want to keep them in memory and execute when queue is up and running.",
      "parentUuid": "f6caf418_c7d6d050",
      "revId": "7af01c2f8c90f080c99f7c08b144e9648197b4d0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "df5bbb41_3667f483",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 6
      },
      "lineNbr": 79,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2019-10-26T03:30:25Z",
      "side": 1,
      "message": "What is the reason to not persist the events right away?",
      "parentUuid": "dfc75455_8633b0e1",
      "revId": "7af01c2f8c90f080c99f7c08b144e9648197b4d0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7e3f0d3c_531b98fd",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 6
      },
      "lineNbr": 79,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2019-10-26T03:48:01Z",
      "side": 1,
      "message": "There is no need for that, they are going to replayed almost immediately, persisting is a much more resource consuming operation and it will be just overkill. Plus we are storing events for different reason. When queue is shutting down we want to make sure that we are not loosing any events. In this case we know that queue is already up and it will be ready in a moment.",
      "parentUuid": "df5bbb41_3667f483",
      "revId": "7af01c2f8c90f080c99f7c08b144e9648197b4d0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b2ec13b1_8498569f",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 6
      },
      "lineNbr": 79,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2019-10-26T04:42:56Z",
      "side": 1,
      "message": "Storing events is not just for shutting down, you never want to lose them. This queue is probably a miss-feature now. With a persistent store, this memory queue provides extra complexity in the code without no gain. Worse, it allows Gerrit to build up unlimited and unthrottled debt. This debt  introduces the extra risk of dropping tasks if the server shutsdown before the queue is empty. Are there any downsides to eliminating it?",
      "parentUuid": "7e3f0d3c_531b98fd",
      "revId": "7af01c2f8c90f080c99f7c08b144e9648197b4d0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d442ed4b_f3a1be29",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationQueue.java",
        "patchSetId": 6
      },
      "lineNbr": 157,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2019-10-26T18:02:12Z",
      "side": 1,
      "message": "I believe is it an erroneous assumption to think that !running means startup, it could also mean shutdown since the stop() sets it to false. What will happen to events that are queued here during shutdown?",
      "range": {
        "startLine": 157,
        "startChar": 8,
        "endLine": 157,
        "endChar": 30
      },
      "revId": "7af01c2f8c90f080c99f7c08b144e9648197b4d0",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}