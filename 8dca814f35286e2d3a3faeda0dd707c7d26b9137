{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "23dc4a91_44cf1ca8",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationTasksStorage.java",
        "patchSetId": 5
      },
      "lineNbr": 109,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-10-01T22:25:50Z",
      "side": 1,
      "message": "This isn\u0027t resolving the case where this problem occurs for the *same* Gerrit node :-( which is currently still possible.",
      "range": {
        "startLine": 109,
        "startChar": 4,
        "endLine": 109,
        "endChar": 27
      },
      "revId": "8dca814f35286e2d3a3faeda0dd707c7d26b9137",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cf015b62_966ba0a1",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationTasksStorage.java",
        "patchSetId": 5
      },
      "lineNbr": 109,
      "author": {
        "id": 1105741
      },
      "writtenOn": "2020-10-02T15:37:40Z",
      "side": 1,
      "message": "Acknowledged. This change is focused on multi-primary scenarios and also I did put up an other change for some additional logging to easily detect such issues here: https://gerrit-review.googlesource.com/c/plugins/replication/+/283296",
      "parentUuid": "23dc4a91_44cf1ca8",
      "range": {
        "startLine": 109,
        "startChar": 4,
        "endLine": 109,
        "endChar": 27
      },
      "revId": "8dca814f35286e2d3a3faeda0dd707c7d26b9137",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "75ea509d_46ebbaf4",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationTasksStorage.java",
        "patchSetId": 5
      },
      "lineNbr": 109,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2020-10-06T23:37:05Z",
      "side": 1,
      "message": "Marking resolved.",
      "parentUuid": "cf015b62_966ba0a1",
      "range": {
        "startLine": 109,
        "startChar": 4,
        "endLine": 109,
        "endChar": 27
      },
      "revId": "8dca814f35286e2d3a3faeda0dd707c7d26b9137",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b37e2fd0_b239592f",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationTasksStorage.java",
        "patchSetId": 5
      },
      "lineNbr": 109,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-10-08T22:54:30Z",
      "side": 1,
      "message": "Change-Id: I74c8e6587 doesn\u0027t look like it is addressing the issue when two replication tasks are colliding on the same Gerrit server.\n\nMarking this as unresolved, as this change isn\u0027t really solving the problem. If we solve the issue with a single Gerrit server, it will be resolved also for the multiple server.\n\nOn the other side, if we use this solution that works only for the multi-server scenario, the single one would still break.",
      "parentUuid": "75ea509d_46ebbaf4",
      "range": {
        "startLine": 109,
        "startChar": 4,
        "endLine": 109,
        "endChar": 27
      },
      "revId": "8dca814f35286e2d3a3faeda0dd707c7d26b9137",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "788ab90a_33a0edc4",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationTasksStorage.java",
        "patchSetId": 5
      },
      "lineNbr": 109,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2020-10-09T16:23:23Z",
      "side": 1,
      "message": "\u003e Change-Id: I74c8e6587 doesn\u0027t look like it is addressing the issue when two replication tasks are colliding on the same Gerrit server.\n\u003e \n\u003e Marking this as unresolved, as this change isn\u0027t really solving the problem. If we solve the issue with a single Gerrit server, it will be resolved also for the multiple server.\n\u003e \n\u003e On the other side, if we use this solution that works only for the multi-server scenario, the single one would still break.\n\nThis change addresses a known existing problem with multi-primary setups. We don\u0027t have a change addressing a known existing problem with single server setups because we don\u0027t know of one (there\u0027s hints of what one might be based on your bug report, but despite significant efforts, it hasn\u0027t reproduced outside your prod env).\n\nLet\u0027s not mix discussions. If you don\u0027t think this change is harmful and/or in fact if it would be helpful to multi-primary setups, please don\u0027t block it.",
      "parentUuid": "b37e2fd0_b239592f",
      "range": {
        "startLine": 109,
        "startChar": 4,
        "endLine": 109,
        "endChar": 27
      },
      "revId": "8dca814f35286e2d3a3faeda0dd707c7d26b9137",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "dd9c7b93_079ff18a",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationTasksStorage.java",
        "patchSetId": 5
      },
      "lineNbr": 109,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2020-10-23T16:34:03Z",
      "side": 1,
      "message": "I\u0027m going to mark this resolved again since there\u0027s been no reply after 2 weeks.",
      "parentUuid": "788ab90a_33a0edc4",
      "range": {
        "startLine": 109,
        "startChar": 4,
        "endLine": 109,
        "endChar": 27
      },
      "revId": "8dca814f35286e2d3a3faeda0dd707c7d26b9137",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "137218df_f7dcdd98",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationTasksStorage.java",
        "patchSetId": 5
      },
      "lineNbr": 109,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-10-27T20:19:16Z",
      "side": 1,
      "message": "Apologies for the delay: I do not see my concerns resolved. The problem is one: the replication tasks are getting lost, with or without concurrency with other Gerrit servers. Marking this as unresolved, waiting for a solution to be found collectively and cooperatively :-)",
      "parentUuid": "dd9c7b93_079ff18a",
      "range": {
        "startLine": 109,
        "startChar": 4,
        "endLine": 109,
        "endChar": 27
      },
      "revId": "8dca814f35286e2d3a3faeda0dd707c7d26b9137",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4dff0d04_6a1c5942",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationTasksStorage.java",
        "patchSetId": 5
      },
      "lineNbr": 109,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2020-10-27T21:01:54Z",
      "side": 1,
      "message": "Can you please explain how this relates to this change because I don\u0027t understand why you think it does?",
      "parentUuid": "137218df_f7dcdd98",
      "range": {
        "startLine": 109,
        "startChar": 4,
        "endLine": 109,
        "endChar": 27
      },
      "revId": "8dca814f35286e2d3a3faeda0dd707c7d26b9137",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2f80fb33_7300752c",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationTasksStorage.java",
        "patchSetId": 5
      },
      "lineNbr": 109,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-10-29T20:43:09Z",
      "side": 1,
      "message": "Two replication tasks can be associated with the same file on the filesystem, regardless if they are generated by a single Gerrit server or by multiple Gerrit servers.\n\nIf we add a generic UUID that makes the replication task unique, we can solve the problem entirely. The current implementation, which just add a UUID per server, won\u0027t solve the problem.\n\nProposal: why not generating the UUID per replication task instead of once per replication storage?",
      "parentUuid": "4dff0d04_6a1c5942",
      "range": {
        "startLine": 109,
        "startChar": 4,
        "endLine": 109,
        "endChar": 27
      },
      "revId": "8dca814f35286e2d3a3faeda0dd707c7d26b9137",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "adb0dc5b_b1411ed9",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationTasksStorage.java",
        "patchSetId": 5
      },
      "lineNbr": 109,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2020-10-29T22:30:28Z",
      "side": 1,
      "message": "Luca, perhaps I\u0027m misunderstanding your response, but I don\u0027t see Martin\u0027s or my earlier questions addressed. To quote my earlier response \"Let\u0027s not mix discussions. If you don\u0027t think this change is harmful and/or in fact if it would be helpful to multi-primary setups, please don\u0027t block it.\" All your responses are focused on a problem I believe you see as related to the problem we\u0027re solving. We don\u0027t have evidence to suggest they are related.\n\nIf you cannot explain how this discussion relates to this change, then this discussion is only serving to derail this change. It is inappropriate to hijack someone\u0027s change to push a different agenda.\n\n@Marco @Edwin Can we get some help from the community managers here? We perceive this entire line of discussion as unrelated to this change, and this latest reply continues to ignore our request to see how this relates to the problem we are trying to solve. It is completely inappropriate and disrespectful to keep pushing an alternative design, and without outlining what use case that design is trying to solve.",
      "parentUuid": "2f80fb33_7300752c",
      "range": {
        "startLine": 109,
        "startChar": 4,
        "endLine": 109,
        "endChar": 27
      },
      "revId": "8dca814f35286e2d3a3faeda0dd707c7d26b9137",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d5ae1ca6_330e9378",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationTasksStorage.java",
        "patchSetId": 5
      },
      "lineNbr": 109,
      "author": {
        "id": 1012732
      },
      "writtenOn": "2020-10-30T12:53:55Z",
      "side": 1,
      "message": "Thanks for reaching out Nasser. So I just had a look at this change and unresolved thread. My very own review comment would be, can Adithya try to see if adding a UUID to each replication task could help 1. simplify this solution for the multi-node problem, and 2. be a more flexible design for other topologies (where N nodes \u003e\u003d 1)?\n\nThe latter would only be an appreciated benefit of the former, without being the main problem to solve here I agree. But at least we would clear the possibility (or opportunity) of simplifying this change -for the main problem it tries to solve (N \u003e 1).\n\nNow, if we cannot confirm the UUID-per-task hypothesis for at least N \u003e 1, then let\u0027s fall-back to this original patch proposal and review it further. Doing so will still require a) focused then b) respectful comments from every reviewer, as per our community code of conduct [1] below.\n\nIf we CMs co-witness otherwise, then we might have to veto unrelated reviews out. This would be unfortunate and something I\u0027d personally hate having to do. So let\u0027s not reach that stage shall we? -We are all experienced and sensible enough professionals after all, working as a team on a shared component that we reuse.\n\n[1] https://www.gerritcodereview.com/codeofconduct.html\n\nI also propose to leave this specific thread unresolved until my proposal above may unfold.",
      "parentUuid": "adb0dc5b_b1411ed9",
      "range": {
        "startLine": 109,
        "startChar": 4,
        "endLine": 109,
        "endChar": 27
      },
      "revId": "8dca814f35286e2d3a3faeda0dd707c7d26b9137",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "667e039c_9154800b",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationTasksStorage.java",
        "patchSetId": 5
      },
      "lineNbr": 273,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2020-10-01T23:07:30Z",
      "side": 1,
      "message": "We probably don\u0027t want to catch this generic exception here.",
      "range": {
        "startLine": 273,
        "startChar": 17,
        "endLine": 273,
        "endChar": 27
      },
      "revId": "8dca814f35286e2d3a3faeda0dd707c7d26b9137",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ef75515c_e3994fef",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationTasksStorage.java",
        "patchSetId": 5
      },
      "lineNbr": 273,
      "author": {
        "id": 1105741
      },
      "writtenOn": "2020-10-02T00:00:08Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "667e039c_9154800b",
      "range": {
        "startLine": 273,
        "startChar": 17,
        "endLine": 273,
        "endChar": 27
      },
      "revId": "8dca814f35286e2d3a3faeda0dd707c7d26b9137",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b4be767d_d321d32e",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationTasksStorage.java",
        "patchSetId": 5
      },
      "lineNbr": 274,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-10-01T22:25:50Z",
      "side": 1,
      "message": "I would be useful to:\n- trace this as a warning, so that the Gerrit admin could be notified of potential issues\n- include the exception as well, so that it is clear which is the cause",
      "range": {
        "startLine": 274,
        "startChar": 10,
        "endLine": 274,
        "endChar": 77
      },
      "revId": "8dca814f35286e2d3a3faeda0dd707c7d26b9137",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9e970e5f_0837520d",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationTasksStorage.java",
        "patchSetId": 5
      },
      "lineNbr": 274,
      "author": {
        "id": 1105741
      },
      "writtenOn": "2020-10-02T00:00:08Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b4be767d_d321d32e",
      "range": {
        "startLine": 274,
        "startChar": 10,
        "endLine": 274,
        "endChar": 77
      },
      "revId": "8dca814f35286e2d3a3faeda0dd707c7d26b9137",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "454da1ab_3655656c",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationTasksStorage.java",
        "patchSetId": 5
      },
      "lineNbr": 274,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2020-10-06T23:37:05Z",
      "side": 1,
      "message": "I disagree with this for the new exception handling in the next PS, as those specific exceptions are expected during startup recovery with multiple primaries. Keeping this atFine() is consistent with other such errors such as line 176 above. Adding this id will make it possible to spot \"same server\" issues as we do in the logging change in this series. The more genertic IOException is being logged below (line 277) at a higher severity.",
      "parentUuid": "9e970e5f_0837520d",
      "range": {
        "startLine": 274,
        "startChar": 10,
        "endLine": 274,
        "endChar": 77
      },
      "revId": "8dca814f35286e2d3a3faeda0dd707c7d26b9137",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9dde24ba_cadb896b",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationTasksStorage.java",
        "patchSetId": 5
      },
      "lineNbr": 274,
      "author": {
        "id": 1105741
      },
      "writtenOn": "2020-10-07T01:54:33Z",
      "side": 1,
      "message": "Done.",
      "parentUuid": "454da1ab_3655656c",
      "range": {
        "startLine": 274,
        "startChar": 10,
        "endLine": 274,
        "endChar": 77
      },
      "revId": "8dca814f35286e2d3a3faeda0dd707c7d26b9137",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "49079446_ba11769c",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationTasksStorage.java",
        "patchSetId": 5
      },
      "lineNbr": 274,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-10-08T22:54:30Z",
      "side": 1,
      "message": "We are not cleaning up tasks but we still don\u0027t give any warning to the Gerrit admin. The directory are supposed to be used as \"lock mechanism\", correct? Would this be potentially a problem later on?",
      "parentUuid": "9dde24ba_cadb896b",
      "range": {
        "startLine": 274,
        "startChar": 10,
        "endLine": 274,
        "endChar": 77
      },
      "revId": "8dca814f35286e2d3a3faeda0dd707c7d26b9137",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2c36f364_09b215d6",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationTasksStorage.java",
        "patchSetId": 5
      },
      "lineNbr": 274,
      "author": {
        "id": 1105741
      },
      "writtenOn": "2020-10-09T07:02:27Z",
      "side": 1,
      "message": "Since the scope of exception is changed to DirectoryNotEmpty, this would happen when there is an other node replicating and it will clean after done.\n\nAlso, removed FileNotFoundException since we are using .deleteIfexists().\n\n@Martin, WDYT ?",
      "parentUuid": "49079446_ba11769c",
      "range": {
        "startLine": 274,
        "startChar": 10,
        "endLine": 274,
        "endChar": 77
      },
      "revId": "8dca814f35286e2d3a3faeda0dd707c7d26b9137",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e724b4b9_31bead86",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationTasksStorage.java",
        "patchSetId": 5
      },
      "lineNbr": 274,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2020-10-09T16:23:23Z",
      "side": 1,
      "message": "\u003e The directory are supposed to be used as \"lock mechanism\", correct?\n\nNo, this change is not adding any locks. Just better identification of tasks in storage.",
      "parentUuid": "2c36f364_09b215d6",
      "range": {
        "startLine": 274,
        "startChar": 10,
        "endLine": 274,
        "endChar": 77
      },
      "revId": "8dca814f35286e2d3a3faeda0dd707c7d26b9137",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c08bc103_50d4206c",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ReplicationTasksStorage.java",
        "patchSetId": 5
      },
      "lineNbr": 274,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2020-10-23T16:34:03Z",
      "side": 1,
      "message": "I don\u0027t see any AIs in this comment thread. Marking as resolved.",
      "parentUuid": "e724b4b9_31bead86",
      "range": {
        "startLine": 274,
        "startChar": 10,
        "endLine": 274,
        "endChar": 77
      },
      "revId": "8dca814f35286e2d3a3faeda0dd707c7d26b9137",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}