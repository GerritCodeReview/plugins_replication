{
  "comments": [
    {
      "key": {
        "uuid": "560dcdbe_5580940e",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/replication/ReplicationIT.java",
        "patchSetId": 4
      },
      "lineNbr": 420,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-06-18T11:12:43Z",
      "side": 1,
      "message": "How is the cancelling of events is simulated/tested?",
      "range": {
        "startLine": 420,
        "startChar": 60,
        "endLine": 420,
        "endChar": 69
      },
      "revId": "2498ef375ed00f00993da1c99468bceafdd01047",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "954bfcdc_ccc5d3df",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/replication/ReplicationIT.java",
        "patchSetId": 4
      },
      "lineNbr": 420,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2020-06-18T13:05:28Z",
      "side": 1,
      "message": "We have invalid remote url and replicationMaxRetries set to 1 so it will retry once and after that task will be cancelled",
      "parentUuid": "560dcdbe_5580940e",
      "range": {
        "startLine": 420,
        "startChar": 60,
        "endLine": 420,
        "endChar": 69
      },
      "revId": "2498ef375ed00f00993da1c99468bceafdd01047",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bd3ebc0e_c4f0ff64",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/replication/ReplicationIT.java",
        "patchSetId": 4
      },
      "lineNbr": 420,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-06-18T16:08:58Z",
      "side": 1,
      "message": "Gotcha, what about adding \"CancelledAfterMaxRetries\" ?",
      "parentUuid": "954bfcdc_ccc5d3df",
      "range": {
        "startLine": 420,
        "startChar": 60,
        "endLine": 420,
        "endChar": 69
      },
      "revId": "2498ef375ed00f00993da1c99468bceafdd01047",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7b28dc44_6155fec7",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/replication/ReplicationIT.java",
        "patchSetId": 4
      },
      "lineNbr": 420,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2020-06-19T08:23:13Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "bd3ebc0e_c4f0ff64",
      "range": {
        "startLine": 420,
        "startChar": 60,
        "endLine": 420,
        "endChar": 69
      },
      "revId": "2498ef375ed00f00993da1c99468bceafdd01047",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0a66c9d5_a21bf812",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/replication/ReplicationIT.java",
        "patchSetId": 4
      },
      "lineNbr": 426,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-06-18T11:12:43Z",
      "side": 1,
      "message": "Why unset? If you set the value it would automatically replace the existing one.",
      "range": {
        "startLine": 426,
        "startChar": 4,
        "endLine": 426,
        "endChar": 47
      },
      "revId": "2498ef375ed00f00993da1c99468bceafdd01047",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bc28b80d_d414834f",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/replication/ReplicationIT.java",
        "patchSetId": 4
      },
      "lineNbr": 426,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2020-06-18T13:05:28Z",
      "side": 1,
      "message": "I wanted be be explicit because we have list of urls",
      "parentUuid": "0a66c9d5_a21bf812",
      "range": {
        "startLine": 426,
        "startChar": 4,
        "endLine": 426,
        "endChar": 47
      },
      "revId": "2498ef375ed00f00993da1c99468bceafdd01047",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4c9b2d05_adc877fd",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/replication/ReplicationIT.java",
        "patchSetId": 4
      },
      "lineNbr": 426,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-06-18T16:08:58Z",
      "side": 1,
      "message": "The the L427 doesn\u0027t *add* a URL but *sets* a URL, so the unset() here is unneeded. have you tried removing it? Would the test still pass?",
      "parentUuid": "bc28b80d_d414834f",
      "range": {
        "startLine": 426,
        "startChar": 4,
        "endLine": 426,
        "endChar": 47
      },
      "revId": "2498ef375ed00f00993da1c99468bceafdd01047",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "acd42eda_e454ab37",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/replication/ReplicationIT.java",
        "patchSetId": 4
      },
      "lineNbr": 426,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2020-06-19T08:23:13Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "4c9b2d05_adc877fd",
      "range": {
        "startLine": 426,
        "startChar": 4,
        "endLine": 426,
        "endChar": 47
      },
      "revId": "2498ef375ed00f00993da1c99468bceafdd01047",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f28a5f2f_27a67f05",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/replication/ReplicationIT.java",
        "patchSetId": 4
      },
      "lineNbr": 433,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-06-18T11:12:43Z",
      "side": 1,
      "message": "Should this instead a waitUntil()? We could have some parts of the test setup that have created replication tasks and some of them could still be running, isn\u0027t it?",
      "range": {
        "startLine": 433,
        "startChar": 4,
        "endLine": 433,
        "endChar": 54
      },
      "revId": "2498ef375ed00f00993da1c99468bceafdd01047",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "644f8676_f8656859",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/replication/ReplicationIT.java",
        "patchSetId": 4
      },
      "lineNbr": 433,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2020-06-18T13:05:28Z",
      "side": 1,
      "message": "Copied from test above, but yes this can be waitUntil",
      "parentUuid": "f28a5f2f_27a67f05",
      "range": {
        "startLine": 433,
        "startChar": 4,
        "endLine": 433,
        "endChar": 54
      },
      "revId": "2498ef375ed00f00993da1c99468bceafdd01047",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "85cab22a_a378992f",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/replication/ReplicationIT.java",
        "patchSetId": 4
      },
      "lineNbr": 433,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-06-18T16:08:58Z",
      "side": 1,
      "message": "Can you change it to a waitUntil()? So that we would avoid potential flakiness.",
      "parentUuid": "644f8676_f8656859",
      "range": {
        "startLine": 433,
        "startChar": 4,
        "endLine": 433,
        "endChar": 54
      },
      "revId": "2498ef375ed00f00993da1c99468bceafdd01047",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "de0ae832_dae4f871",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/replication/ReplicationIT.java",
        "patchSetId": 4
      },
      "lineNbr": 433,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2020-06-19T08:23:13Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "85cab22a_a378992f",
      "range": {
        "startLine": 433,
        "startChar": 4,
        "endLine": 433,
        "endChar": 54
      },
      "revId": "2498ef375ed00f00993da1c99468bceafdd01047",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d6a140a9_944a50fa",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/replication/ReplicationIT.java",
        "patchSetId": 4
      },
      "lineNbr": 436,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-06-18T11:12:43Z",
      "side": 1,
      "message": "If the replication event starts and finishes immediately, this wait() may never wake up :-(",
      "range": {
        "startLine": 436,
        "startChar": 0,
        "endLine": 436,
        "endChar": 84
      },
      "revId": "2498ef375ed00f00993da1c99468bceafdd01047",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "63c10300_64952a12",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/replication/ReplicationIT.java",
        "patchSetId": 4
      },
      "lineNbr": 436,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2020-06-18T13:05:28Z",
      "side": 1,
      "message": "we have 1 second delay for replication start. we should be in that line before replication happened. You are right it\u0027s a bit risky but I\u0027m not sure how to check that in a different way. But let me have a second look",
      "parentUuid": "d6a140a9_944a50fa",
      "range": {
        "startLine": 436,
        "startChar": 0,
        "endLine": 436,
        "endChar": 84
      },
      "revId": "2498ef375ed00f00993da1c99468bceafdd01047",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "df634ccb_013e961c",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/replication/ReplicationIT.java",
        "patchSetId": 4
      },
      "lineNbr": 436,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2020-06-18T21:49:47Z",
      "side": 1,
      "message": "I think there are many tests which are doing this, and they seem to be reliable enough.",
      "parentUuid": "63c10300_64952a12",
      "range": {
        "startLine": 436,
        "startChar": 0,
        "endLine": 436,
        "endChar": 84
      },
      "revId": "2498ef375ed00f00993da1c99468bceafdd01047",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8581c5c1_1ed66791",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/replication/ReplicationIT.java",
        "patchSetId": 4
      },
      "lineNbr": 437,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-06-18T11:12:43Z",
      "side": 1,
      "message": "This is too implicit IMHO: you know that there is a retry because the creation of a new project is triggering a replication event in retry mode, correct? That isn\u0027t really obvious for the reader though :-(",
      "range": {
        "startLine": 437,
        "startChar": 13,
        "endLine": 437,
        "endChar": 29
      },
      "revId": "2498ef375ed00f00993da1c99468bceafdd01047",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "93405d21_4fd195c2",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/replication/ReplicationIT.java",
        "patchSetId": 4
      },
      "lineNbr": 437,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2020-06-18T13:05:28Z",
      "side": 1,
      "message": "Replication retry is set to minimum value which is 1 minute. This means that when task is rescheduled is moved from running, that\u0027s why I\u0027m checking if this happened",
      "parentUuid": "8581c5c1_1ed66791",
      "range": {
        "startLine": 437,
        "startChar": 13,
        "endLine": 437,
        "endChar": 29
      },
      "revId": "2498ef375ed00f00993da1c99468bceafdd01047",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "82bba8c5_9f7e7901",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/replication/ReplicationIT.java",
        "patchSetId": 4
      },
      "lineNbr": 437,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-06-18T16:08:58Z",
      "side": 1,
      "message": "Can you add that information to the comment? So that is clearer for the reader to understand what\u0027s going on here.",
      "parentUuid": "93405d21_4fd195c2",
      "range": {
        "startLine": 437,
        "startChar": 13,
        "endLine": 437,
        "endChar": 29
      },
      "revId": "2498ef375ed00f00993da1c99468bceafdd01047",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b774ca98_26e8109f",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/replication/ReplicationIT.java",
        "patchSetId": 4
      },
      "lineNbr": 437,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2020-06-19T08:23:13Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "82bba8c5_9f7e7901",
      "range": {
        "startLine": 437,
        "startChar": 13,
        "endLine": 437,
        "endChar": 29
      },
      "revId": "2498ef375ed00f00993da1c99468bceafdd01047",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "16f3569d_a23efb3f",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/replication/ReplicationIT.java",
        "patchSetId": 4
      },
      "lineNbr": 440,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-06-18T11:12:43Z",
      "side": 1,
      "message": "Do we have any way to check that this was actually a retried event?",
      "range": {
        "startLine": 440,
        "startChar": 4,
        "endLine": 440,
        "endChar": 84
      },
      "revId": "2498ef375ed00f00993da1c99468bceafdd01047",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c5304223_edbf9b7d",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/replication/ReplicationIT.java",
        "patchSetId": 4
      },
      "lineNbr": 440,
      "author": {
        "id": 1083454
      },
      "writtenOn": "2020-06-18T13:05:28Z",
      "side": 1,
      "message": "I was looking if I can get PushOp from replication queue but it doesn\u0027t look like. But let me have a second look, maybe there is a way to get those data(maybe I can read them from the taskStorage)",
      "parentUuid": "16f3569d_a23efb3f",
      "range": {
        "startLine": 440,
        "startChar": 4,
        "endLine": 440,
        "endChar": 84
      },
      "revId": "2498ef375ed00f00993da1c99468bceafdd01047",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0cfbc998_346c7691",
        "filename": "src/test/java/com/googlesource/gerrit/plugins/replication/ReplicationIT.java",
        "patchSetId": 4
      },
      "lineNbr": 440,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2020-06-18T21:49:47Z",
      "side": 1,
      "message": "I think that since you checked that it was 0 above, you can assume that it is a retry since we are not triggering any other replication events. There is no indication via the ReplicationTasksStorage that something is a retry, but it does store the specific values of an event, so if you wanted to be more specific you could check that an event contains the specific details that you expect.\n\nI think it is important to keep the bar low for tests, i.e. we want to encourage tests, and lean more towards good than perfect to ensure that we have tests! Test mechanisms can always be improved pretty easily if one turns out to be unreliable as long as the intent is clear. I was able to grasp the intent of these tests fairly quickly, the hardest part for me was realizing that the push would get canceled implicitly because of the invalid url, and Luca already suggested to encode that into the test name.",
      "parentUuid": "c5304223_edbf9b7d",
      "range": {
        "startLine": 440,
        "startChar": 4,
        "endLine": 440,
        "endChar": 84
      },
      "revId": "2498ef375ed00f00993da1c99468bceafdd01047",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}