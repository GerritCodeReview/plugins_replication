{
  "comments": [
    {
      "key": {
        "uuid": "3dad41fd_92f41cc1",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/Destination.java",
        "patchSetId": 10
      },
      "lineNbr": 280,
      "author": {
        "id": 1012098
      },
      "writtenOn": "2013-06-12T21:06:46Z",
      "side": 1,
      "message": "This should still combine refs for jobs that are pending (not in flight).",
      "revId": "69d590eece16de24742e93c1c6fb5d80173a629b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1db23d5c_91b37cf8",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/Destination.java",
        "patchSetId": 10
      },
      "lineNbr": 356,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2013-06-12T20:58:42Z",
      "side": 1,
      "message": "We have actually been running this patch in production for a few days now, and I think that it is not fine grained enough.  If I understand, the URI does not contain the ref being pushed which means that this completely serializes all the pushes per project?\n\nSince we have several active projects that take a while to replicate ~20-30s, this can be problematic when there are several changes in one of those projects needing replication.   In effect, what was a decent replication time 30s, can now become several minutes instead.   I am not sure that serializing everything without regards to the refs is wise; there is no reason that multiple changes shouldn\u0027t be pushed in parallel, is there?",
      "revId": "69d590eece16de24742e93c1c6fb5d80173a629b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1db23d5c_f1a80882",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/Destination.java",
        "patchSetId": 10
      },
      "lineNbr": 356,
      "author": {
        "id": 1012098
      },
      "writtenOn": "2013-06-12T21:06:46Z",
      "side": 1,
      "message": "That shouldn\u0027t be the case.  The plugin will still combine refs for jobs in the pending queue.  Can you instrument your code to verify that this is or isn\u0027t happening?",
      "parentUuid": "1db23d5c_91b37cf8",
      "revId": "69d590eece16de24742e93c1c6fb5d80173a629b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1db23d5c_d1ad0490",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/Destination.java",
        "patchSetId": 10
      },
      "lineNbr": 356,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2013-06-12T21:09:51Z",
      "side": 1,
      "message": "We are indeed instrumenting it and going to confirm.  We have patches for instrumenting that we will push also...",
      "parentUuid": "1db23d5c_f1a80882",
      "revId": "69d590eece16de24742e93c1c6fb5d80173a629b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8a98a1f6_9c7385ae",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/Destination.java",
        "patchSetId": 10
      },
      "lineNbr": 356,
      "author": {
        "id": 1012098
      },
      "writtenOn": "2013-06-27T07:16:58Z",
      "side": 1,
      "message": "Any update?\n\nThis patch has greatly improved the reliability of replication on our gerrit server, and I would like to see it merged, but my attention span is waning.",
      "parentUuid": "1db23d5c_d1ad0490",
      "revId": "69d590eece16de24742e93c1c6fb5d80173a629b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e70cf8c1_472b4e84",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/Destination.java",
        "patchSetId": 10
      },
      "lineNbr": 356,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2013-07-10T07:38:59Z",
      "side": 1,
      "message": "Martin, any further comments?",
      "parentUuid": "8a98a1f6_9c7385ae",
      "revId": "69d590eece16de24742e93c1c6fb5d80173a629b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a8863bc4_c801381d",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/Destination.java",
        "patchSetId": 10
      },
      "lineNbr": 356,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2018-02-28T14:52:33Z",
      "side": 1,
      "message": "I checked how the replications get (re)scheduled and if replications for the same project are serialized. Turns out that they are somewhat serialized.\n\nAssume there is an in-flight push to the project Foo and a new change C1 for the same project is uploaded. Replication of C1 gets scheduled but, since there is an in-flight push, it will not run. Instead it will be rescheduled to be run later. This, later to run replication task, gets\nan ID\u003d12345\n\nIn the meantime, yet another change C2 for the project Foo is uploaded. Replication of C2 gets scheduled and, because there is a waiting replication task with ID\u003d12345 for the same project Foo, replication of C2 gets assigned to the same task.\n\nWhen the in-flight push is done, the replication task 12345 will be started and it will replicate both C1 and C2 in one push. This is the reason why replications for the same project\nare not fully serialized.\n\nHowever, as we see from the above example, replication of C1 and C2 had to wait for the\ncurrent in-flight push to finish, although currently running push was not updating neither\nof C1 and C2. Pushing of C1 and C2 *could* have been done in parallel to the other push.\nThis is why replications are \"somewhat\" serialized.\n\nFor repositories with excessive number of refs (\u003e500K) one replication could take few minutes.\nThe above described serialization behavior may cause latencies longer than\ntechnically necessary.",
      "parentUuid": "e70cf8c1_472b4e84",
      "revId": "69d590eece16de24742e93c1c6fb5d80173a629b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}