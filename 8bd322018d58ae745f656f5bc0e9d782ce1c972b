{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "db9cbb72_d7a1bfae",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1010134
      },
      "writtenOn": "2023-12-12T14:50:36Z",
      "side": 1,
      "message": "verified locally with `bazel test --test_tag_filters\u003dreplication //...` - no test failures.",
      "revId": "8bd322018d58ae745f656f5bc0e9d782ce1c972b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d7aaf562_dd95aac3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-12-12T17:12:07Z",
      "side": 1,
      "message": "I think I see what you are trying to achieve and it kind of makes sense, but I think the naming lets you down, and makes this very confusing and hard to grasp.",
      "revId": "8bd322018d58ae745f656f5bc0e9d782ce1c972b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "23876c4c_329b7a3e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1010134
      },
      "writtenOn": "2023-12-12T17:54:37Z",
      "side": 1,
      "message": "yeah, naming things is hard üòê\n\nI couldn\u0027t come up with better names, as \"ConfigFile\" is misleading, \"Config\" is clashing with JGit, and \"RawReplicationConfig\" sounds odd. For now, the best thing that I could come up with is `ConfigResource` as it\u0027s abstract and short enough.",
      "parentUuid": "d7aaf562_dd95aac3",
      "revId": "8bd322018d58ae745f656f5bc0e9d782ce1c972b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9c2b9542_c1b28528",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/AutoReloadConfigDecorator.java",
        "patchSetId": 3
      },
      "lineNbr": 45,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-12-12T17:12:07Z",
      "side": 1,
      "message": "why is the type changing here? Why not keep the `ReplicationConfig` type?",
      "revId": "8bd322018d58ae745f656f5bc0e9d782ce1c972b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b19f5ebf_c5e53427",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/AutoReloadConfigDecorator.java",
        "patchSetId": 3
      },
      "lineNbr": 45,
      "author": {
        "id": 1010134
      },
      "writtenOn": "2023-12-12T17:54:37Z",
      "side": 1,
      "message": "because in `ReplicationConfigModule` L51 we bind `ReplicationConfig` to `AutoReloadConfigDecorator` and injecting here `ReplicationConfig` would create a cyclic dependency and break the injection.",
      "parentUuid": "9c2b9542_c1b28528",
      "revId": "8bd322018d58ae745f656f5bc0e9d782ce1c972b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d80fb81e_207e6790",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/AutoReloadConfigDecorator.java",
        "patchSetId": 3
      },
      "lineNbr": 45,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-12-27T13:29:46Z",
      "side": 1,
      "message": "Sorry, I don\u0027t follow, even in the previous implementation this should have been a problem then? Or you are saying the `MainReplicationConfig` annotation prevented this from happening? \n\nThe problem here though here is that you are somewhat breaking up the concept of the auto-reload being able to work with _any_ config resource. For example prior to your change, auto-reload would work with a fanout resource, now it won\u0027t.",
      "parentUuid": "b19f5ebf_c5e53427",
      "revId": "8bd322018d58ae745f656f5bc0e9d782ce1c972b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0a8ab78e_21f7009a",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/AutoReloadConfigDecorator.java",
        "patchSetId": 3
      },
      "lineNbr": 45,
      "author": {
        "id": 1010134
      },
      "writtenOn": "2023-12-27T21:17:22Z",
      "side": 1,
      "message": "\u003e Sorry, I don\u0027t follow, even in the previous implementation this should have been a problem then? Or you are saying the MainReplicationConfig annotation prevented this from happening?\n\nI\u0027m saying that `@MainReplicationConfig` is not necessary anymore, as we don\u0027t have to differentiate between \"main\" and \"secondary\" configs, as we only have one type of `ReplicationConfig` now.\n\n\u003e The problem here though here is that you are somewhat breaking up the concept of the auto-reload being able to work with any config resource. For example prior to your change, auto-reload would work with a fanout resource, now it won\u0027t.\n\nThe auto-reload concept is based on periodically checking the `ReplicationConfig.getVersion()`. Now this method delegates to `ConfigResource.getVersion()`, so nothing is broken, we just moved that responsibility into the lower layer.\n\nIf you look at `FanoutConfigResource` you\u0027ll see that it has the same code as `FanoutBasedReplicationConfig`, minus the code for extracting configuration options.\n\nNow the auto-reload will work for any `ConfigResource` implementation, provided it implements `getVersion()` correctly.",
      "parentUuid": "d80fb81e_207e6790",
      "revId": "8bd322018d58ae745f656f5bc0e9d782ce1c972b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "59ec5503_030a0280",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/AutoReloadConfigDecorator.java",
        "patchSetId": 3
      },
      "lineNbr": 45,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-12-28T10:40:08Z",
      "side": 1,
      "message": "ah i see it now, the `ConfigResourceBasedReplicationConfig` inherits the `ConfigResource` via composition. Sorry this was the part I was missing!",
      "parentUuid": "0a8ab78e_21f7009a",
      "revId": "8bd322018d58ae745f656f5bc0e9d782ce1c972b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a68e0625_7864994f",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ConfigResourceBasedReplicationConfig.java",
        "patchSetId": 3
      },
      "lineNbr": 25,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-12-12T17:12:07Z",
      "side": 1,
      "message": "I think this class should simply be called `ReplicationConfigImpl` or at least something more similar and short, the fact it starts and finishes with the word Config and also contains the word Resource makes it very confusing!",
      "revId": "8bd322018d58ae745f656f5bc0e9d782ce1c972b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "15f01a04_33d13281",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ConfigResourceBasedReplicationConfig.java",
        "patchSetId": 3
      },
      "lineNbr": 25,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-12-12T17:12:07Z",
      "side": 1,
      "message": "I also think we are missing (or mixing up) an abstraction here (or perhaps I am getting confused by the naming of these classes). In my mind, there\u0027s a `ReplicationConfig` interface, and then you have different implementations (filebased, zookeeper etc).",
      "revId": "8bd322018d58ae745f656f5bc0e9d782ce1c972b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "517c6bdd_46260c18",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ConfigResourceBasedReplicationConfig.java",
        "patchSetId": 3
      },
      "lineNbr": 25,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-12-12T17:12:07Z",
      "side": 1,
      "message": "Finally, I think this should have been a different change üòä",
      "revId": "8bd322018d58ae745f656f5bc0e9d782ce1c972b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c303b386_1a0fbb5e",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ConfigResourceBasedReplicationConfig.java",
        "patchSetId": 3
      },
      "lineNbr": 25,
      "author": {
        "id": 1010134
      },
      "writtenOn": "2023-12-12T17:54:37Z",
      "side": 1,
      "message": "Think about `ReplicationConfig` like it is a `JDBC` and `ConfigResource` a driver. The JDBC provides you a common high-level API to interact with DBMS, you don\u0027t think about the underlying protocol implementation and you can switch between drivers to use different databases.\n\nThe `ConfigResource` provides you with a raw \"table\" of configuration options. From this, the `RepilcationConfig` picks those that are interesting for it.\n\nNaming could be off a bit, but I think the separation of concerns between the \"data source\" and \"data format\" is the way to go here.",
      "parentUuid": "15f01a04_33d13281",
      "revId": "8bd322018d58ae745f656f5bc0e9d782ce1c972b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e73b878e_92462cd5",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ConfigResourceBasedReplicationConfig.java",
        "patchSetId": 3
      },
      "lineNbr": 25,
      "author": {
        "id": 1010134
      },
      "writtenOn": "2023-12-12T17:54:37Z",
      "side": 1,
      "message": "This chain is already long and complicated enough ;) spanning across multiple projects and commits, let\u0027s not make it even more complex ;)",
      "parentUuid": "517c6bdd_46260c18",
      "revId": "8bd322018d58ae745f656f5bc0e9d782ce1c972b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d4eb36cb_83e7faaa",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ConfigResourceBasedReplicationConfig.java",
        "patchSetId": 3
      },
      "lineNbr": 25,
      "author": {
        "id": 1010134
      },
      "writtenOn": "2023-12-12T17:54:37Z",
      "side": 1,
      "message": "Maybe `DefaultReplicationConfig`? WDYT? @sasa.zivkov@sap.com?",
      "parentUuid": "a68e0625_7864994f",
      "revId": "8bd322018d58ae745f656f5bc0e9d782ce1c972b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "03eef214_4c5366c9",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ConfigResourceBasedReplicationConfig.java",
        "patchSetId": 3
      },
      "lineNbr": 25,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-12-27T13:29:46Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "c303b386_1a0fbb5e",
      "revId": "8bd322018d58ae745f656f5bc0e9d782ce1c972b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dc110862_fd52cad0",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ConfigResourceBasedReplicationConfig.java",
        "patchSetId": 3
      },
      "lineNbr": 25,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-12-27T13:29:46Z",
      "side": 1,
      "message": "`ReplicationConfigImpl` is the most generic and unambiguous name I can think of.",
      "parentUuid": "d4eb36cb_83e7faaa",
      "revId": "8bd322018d58ae745f656f5bc0e9d782ce1c972b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0a75ad35_89d3b855",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ConfigResourceBasedReplicationConfig.java",
        "patchSetId": 3
      },
      "lineNbr": 25,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-12-27T13:29:46Z",
      "side": 1,
      "message": "Yet reviewing this change is already hard enough ;)",
      "parentUuid": "e73b878e_92462cd5",
      "revId": "8bd322018d58ae745f656f5bc0e9d782ce1c972b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0b00ca2e_7d44390b",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ConfigResourceBasedReplicationConfig.java",
        "patchSetId": 3
      },
      "lineNbr": 25,
      "author": {
        "id": 1010134
      },
      "writtenOn": "2023-12-27T21:17:22Z",
      "side": 1,
      "message": "Although the idea of `ConfigResource` (now) looks simple and easy, it took me some time to figure that out ;)\n\nI may not be able to convey it in a easy to understand way üòû",
      "parentUuid": "0a75ad35_89d3b855",
      "revId": "8bd322018d58ae745f656f5bc0e9d782ce1c972b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "41e7c04c_7b98986b",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ConfigResourceBasedReplicationConfig.java",
        "patchSetId": 3
      },
      "lineNbr": 25,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-12-28T10:40:08Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "0b00ca2e_7d44390b",
      "revId": "8bd322018d58ae745f656f5bc0e9d782ce1c972b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f18b1faa_ded11525",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ConfigResourceBasedReplicationConfig.java",
        "patchSetId": 3
      },
      "lineNbr": 40,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-12-12T17:12:07Z",
      "side": 1,
      "message": "theoretically this class is agnostic to the implementation details, yet here we are forcing a FileConfigResource. Perhaps this class was named correctly after all.",
      "revId": "8bd322018d58ae745f656f5bc0e9d782ce1c972b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b5697df8_2b1d745e",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ConfigResourceBasedReplicationConfig.java",
        "patchSetId": 3
      },
      "lineNbr": 40,
      "author": {
        "id": 1010134
      },
      "writtenOn": "2023-12-12T17:54:37Z",
      "side": 1,
      "message": "this was added to limit the amount of changes in the patch set. It is only used in tests, without this we\u0027d have a longer list of modified files. So, this is only for convenience.",
      "parentUuid": "f18b1faa_ded11525",
      "revId": "8bd322018d58ae745f656f5bc0e9d782ce1c972b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "971defe3_533dda08",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/ConfigResourceBasedReplicationConfig.java",
        "patchSetId": 3
      },
      "lineNbr": 40,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-12-27T13:29:46Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "b5697df8_2b1d745e",
      "revId": "8bd322018d58ae745f656f5bc0e9d782ce1c972b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6a1c6fbc_3233586b",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/FanoutConfigResource.java",
        "patchSetId": 3
      },
      "lineNbr": 140,
      "author": {
        "id": 1157810
      },
      "writtenOn": "2023-12-12T17:12:07Z",
      "side": 1,
      "message": "this change is not necessary",
      "revId": "8bd322018d58ae745f656f5bc0e9d782ce1c972b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a713ce17_a0ed52c7",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/FanoutConfigResource.java",
        "patchSetId": 3
      },
      "lineNbr": 140,
      "author": {
        "id": 1010134
      },
      "writtenOn": "2023-12-12T18:40:42Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6a1c6fbc_3233586b",
      "revId": "8bd322018d58ae745f656f5bc0e9d782ce1c972b",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}