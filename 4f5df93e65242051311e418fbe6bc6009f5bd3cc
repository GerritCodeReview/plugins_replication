{
  "comments": [
    {
      "key": {
        "uuid": "4570775d_076a82ba",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/AutoReloadConfigDecorator.java",
        "patchSetId": 36
      },
      "lineNbr": 41,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-09-13T11:27:39Z",
      "side": 1,
      "message": "Why is \"volatile\" removed here? How do we ensure that updates on currentConfig made\nfrom one thread are visible to other threads?",
      "revId": "4f5df93e65242051311e418fbe6bc6009f5bd3cc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e1cfed43_deb88ac9",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/AutoReloadConfigDecorator.java",
        "patchSetId": 36
      },
      "lineNbr": 41,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-13T12:19:37Z",
      "side": 1,
      "message": "Good catch, it should remain volatile.",
      "parentUuid": "4570775d_076a82ba",
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "4f5df93e65242051311e418fbe6bc6009f5bd3cc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6ccf0345_928a6deb",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/AutoReloadConfigDecorator.java",
        "patchSetId": 36
      },
      "lineNbr": 41,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-13T12:21:45Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e1cfed43_deb88ac9",
      "revId": "4f5df93e65242051311e418fbe6bc6009f5bd3cc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "40cf48c8_79dc2a8b",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/AutoReloadConfigDecorator.java",
        "patchSetId": 36
      },
      "lineNbr": 48,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-09-13T11:27:39Z",
      "side": 1,
      "message": "final",
      "revId": "4f5df93e65242051311e418fbe6bc6009f5bd3cc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ebad1267_c2249fff",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/AutoReloadConfigDecorator.java",
        "patchSetId": 36
      },
      "lineNbr": 48,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-13T12:19:37Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "40cf48c8_79dc2a8b",
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "4f5df93e65242051311e418fbe6bc6009f5bd3cc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ac9f1747_f9f4a239",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/AutoReloadConfigDecorator.java",
        "patchSetId": 36
      },
      "lineNbr": 120,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-09-13T11:27:39Z",
      "side": 1,
      "message": "Why is this not synchronized and the startup method is?",
      "revId": "4f5df93e65242051311e418fbe6bc6009f5bd3cc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3721a0ca_ee34dfb7",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/AutoReloadConfigDecorator.java",
        "patchSetId": 36
      },
      "lineNbr": 120,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-13T12:21:45Z",
      "side": 1,
      "message": "It is described in the comment above.\nMaking it synchronised would potentially cause deadlock.",
      "parentUuid": "ac9f1747_f9f4a239",
      "revId": "4f5df93e65242051311e418fbe6bc6009f5bd3cc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9df4997e_147b217f",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/AutoReloadConfigDecorator.java",
        "patchSetId": 36
      },
      "lineNbr": 120,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-09-13T14:43:29Z",
      "side": 1,
      "message": "\u003e It is described in the comment above.\n\u003e Making it synchronised would potentially cause deadlock.\n\nThis sound quite theoretical... do we know any code path that will actually cause a dead-lock\nin this case?\n\nStrictly, this code is incorrect without synchronizing the access to the autoReloadRunnable.\nRemember that an update to a variable done from one thread may never be visible to the other thread(s) when access to that variable (both read and write) is not synchronized.\n\nCan we at least synchronize the block 121-124?",
      "parentUuid": "3721a0ca_ee34dfb7",
      "revId": "4f5df93e65242051311e418fbe6bc6009f5bd3cc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6056ca36_f94e43a1",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/AutoReloadConfigDecorator.java",
        "patchSetId": 36
      },
      "lineNbr": 120,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-13T15:00:24Z",
      "side": 1,
      "message": "\u003e \u003e It is described in the comment above.\n\u003e \u003e Making it synchronised would potentially cause deadlock.\n\u003e \n\u003e This sound quite theoretical... do we know any code path that will actually cause a dead-lock\n\u003e in this case?\n\nSee Change-Id: Ief6f2bee9124.\n\n\u003e Strictly, this code is incorrect without synchronizing the access to the autoReloadRunnable.\n\u003e Remember that an update to a variable done from one thread may never be visible to the other thread(s) when access to that variable (both read and write) is not synchronized.\n\nTrue, I need to set the autoReloadRunnable volatile.\n\n\u003e Can we at least synchronize the block 121-124?\n\nYes, that makes sense. Let me synchronize that block.\nThe only problematic part was the currentConfig.shutdown(), that part needed to be outside the critical section.",
      "parentUuid": "9df4997e_147b217f",
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "4f5df93e65242051311e418fbe6bc6009f5bd3cc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "537804dc_ab88f5fe",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/AutoReloadRunnable.java",
        "patchSetId": 36
      },
      "lineNbr": 75,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-09-13T11:27:39Z",
      "side": 1,
      "message": "Instead of combining the forceReload with other criteria here, which makes the whole\nif-condition more complex, do the following:\n\n* let the reload method just perform reload, unconditionally\n* from the forceReload method just call the reload (no need to pass a flag)\n* move the rest of the if-condition (the normal reload check) to the run method",
      "range": {
        "startLine": 70,
        "startChar": 0,
        "endLine": 75,
        "endChar": 41
      },
      "revId": "4f5df93e65242051311e418fbe6bc6009f5bd3cc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f7f0ac7c_6162edb1",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/AutoReloadRunnable.java",
        "patchSetId": 36
      },
      "lineNbr": 75,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-13T12:19:37Z",
      "side": 1,
      "message": "Yes, good suggestion for breaking the complexity down.",
      "parentUuid": "537804dc_ab88f5fe",
      "range": {
        "startLine": 70,
        "startChar": 0,
        "endLine": 75,
        "endChar": 41
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "4f5df93e65242051311e418fbe6bc6009f5bd3cc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c506e182_b577485d",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/AutoReloadRunnable.java",
        "patchSetId": 36
      },
      "lineNbr": 75,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-13T12:21:45Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f7f0ac7c_6162edb1",
      "range": {
        "startLine": 70,
        "startChar": 0,
        "endLine": 75,
        "endChar": 41
      },
      "revId": "4f5df93e65242051311e418fbe6bc6009f5bd3cc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}