{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "4121ef33_09998338",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 7,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2020-06-03T18:16:11Z",
      "side": 1,
      "message": "Perhaps it would be better to re-enable replicateProjectsOnStartup by default, as it is generally a bad thing to disable except in multi-master scenarios with a workaround? This change seems like a reflection of the bad policy of disabling it.",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 56
      },
      "revId": "f26aa0d9feeda1216e7d29f56f5bcde12b94dcc4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bdaff0b2_e82316c0",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 7,
      "author": {
        "id": 1014257
      },
      "writtenOn": "2020-06-08T10:02:54Z",
      "side": 1,
      "message": "Well, I think even without multi-master one might prefer not to replicate everything on startup, especially if that involves thousands of projects to be replicated.",
      "parentUuid": "4121ef33_09998338",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 56
      },
      "revId": "f26aa0d9feeda1216e7d29f56f5bcde12b94dcc4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c9e7128f_a12e138a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 7,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-06-09T07:56:45Z",
      "side": 1,
      "message": "\u003e Well, I think even without multi-master one might prefer not to replicate everything on startup, especially if that involves thousands of projects to be replicated.\n\nI tend to agree with Eryk: it all depends on how many projects you have and how many remotes you have. With tens of thousands of projects and hundreds of remotes, triggering the replication of everything to everywhere is definitely a no-go (e.g. 10k projects x 100 remotes \u003d 1M pushes, it will take forever).\n\nAlso with a smaller number of projects (e.g. 100 and a few remotes like 10) it will still generate a huge number of pushes.\n\nI believe what Eryk is proposing makes sense: *some* projects could be super critical to be always pushed at start, others are not. Bearing in mind that a git push even when there is nothing to push would still go through the refs advertisement phase that could potentially take a very long time.",
      "parentUuid": "bdaff0b2_e82316c0",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 56
      },
      "revId": "f26aa0d9feeda1216e7d29f56f5bcde12b94dcc4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "80ca7af3_133d4058",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 7,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2020-06-10T08:47:53Z",
      "side": 1,
      "message": "I agree.  I don\u0027t think it\u0027s practical to always replicate everything at start, but there are some projects that it makes sense to always replicate.",
      "parentUuid": "c9e7128f_a12e138a",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 56
      },
      "revId": "f26aa0d9feeda1216e7d29f56f5bcde12b94dcc4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b552da37_5cd35269",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 7,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2020-06-15T23:08:01Z",
      "side": 1,
      "message": "I think this using this \"feature\" is fundamentally asking for a broken setup with the hopes that no one notices, and I think it would be bad advice to let the users of the replication plugin think that this is a good idea.\n\nWe don\u0027t have 1M replication events, but we do have 100K events, and we still expect to never loose events and we ensure that replicate start all is run after any master server goes down. We have 9 master servers, and we restart them weekly, (which does create close to 1M events) and this does scale for us, and there are several existing proposed major improvements that will make this much better even, and many that could still be done (git protocol v2!). I don\u0027t think that it is unreasonable to think that if a service has 1M replication events that this can be handled by the replication plugin with the right amount of server horsepower.\n\nTurning a feature off is not a scaling solution, and I think we are doing a dis-service to the community if we don\u0027t seek and apply solutions to scalability problems instead of turning features off. This change https://gerrit-review.googlesource.com/c/plugins/replication/+/267812 can greatly reduce the impact of massive startup replication, it would be good if Luca could try this change, and also the MM master fixes here https://gerrit-review.googlesource.com/c/plugins/replication/+/265572 before giving up on making replication reliable for \"all-but-a-select-few\" projects on a server. I would rather we fix our code base than we add workarounds for performance \"bugs\".\n\nIs there any reason for this change other than the current performance issue?",
      "parentUuid": "80ca7af3_133d4058",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 56
      },
      "revId": "f26aa0d9feeda1216e7d29f56f5bcde12b94dcc4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6a33ace4_b94bae36",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 7,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2020-06-15T23:19:09Z",
      "side": 1,
      "message": "\u003e We don\u0027t have 1M replication events, but we do have 100K events, and we still expect to never loose events and we ensure that replicate start all is run after any master server goes down. We have 9 master servers, and we restart them weekly, (which does create close to 1M events) and this does scale for us.\n\nI want to clarify a bit here, while we have 9 masters, only 3 are actively used, which means that we do get approximately 900K events (since they all get restarted), but only 3 of the masters are serving those 900K events. If we started replicating from all of those masters, it would go even better.",
      "parentUuid": "b552da37_5cd35269",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 56
      },
      "revId": "f26aa0d9feeda1216e7d29f56f5bcde12b94dcc4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6a508ca7_de446b56",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 7,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2020-06-15T23:27:11Z",
      "side": 1,
      "message": "\u003e Is there any reason for this change other than the current performance issue?\n\nThe use case for us is we want to ensure that All-Projects and All-Users is always replicated.",
      "parentUuid": "6a33ace4_b94bae36",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 56
      },
      "revId": "f26aa0d9feeda1216e7d29f56f5bcde12b94dcc4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "937132d1_27691d27",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 7,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2020-06-15T23:29:40Z",
      "side": 1,
      "message": "What is the use case when using replication as designed (i.e. with startup replication on)?",
      "parentUuid": "6a508ca7_de446b56",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 56
      },
      "revId": "f26aa0d9feeda1216e7d29f56f5bcde12b94dcc4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6d6ef3e8_95b32d8d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 7,
      "author": {
        "id": 1011123
      },
      "writtenOn": "2020-06-15T23:49:49Z",
      "side": 1,
      "message": "We don\u0027t want to replicate everything at startup.",
      "parentUuid": "937132d1_27691d27",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 56
      },
      "revId": "f26aa0d9feeda1216e7d29f56f5bcde12b94dcc4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "23f457ae_d949b01f",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 7,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2020-06-16T00:20:48Z",
      "side": 1,
      "message": "\u003e We don\u0027t want to replicate everything at startup.\n\nThe sentence above is already supported, despite it not being a use case. The currently expressed desire for this knob is the equivalent of \"I just want it to work this way\", but no justification is being provided.\n\nA use case is something like: \"I would like any update on my server to get replicated to my remotes\". If this is not working, than there is a bug. The design of the replication plugin requires that you either keep startup replication turned on or that you manually run replication start at some point after a server has been \"downed\". This change does not alter this, it only provides a knob that when turned on will provide the illusion that a broken setup works. I cannot recommend such a knob for community use.\n\nTurning off startup replication is not a recommendation for general community use. And if we are to recommend doing it to the community, then I think we should have a good reason to do so. We do it because we have an external customization that fires this at time more appropriate for a multi-master setup. This customization is specific to a specific multi-master implementation, and it would not be appropriate currently for the replication plugin to have to carry code that we could not recommend that others in the community to use. Since what you are trying to do is currently possible to achieve without modifying the replication plugin (via a startup script wrapper which calls replicate start on the projects you want) I don\u0027t think the community should bare the burden of this config option without a strong use case that we could recommend the community to use.",
      "parentUuid": "6d6ef3e8_95b32d8d",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 56
      },
      "revId": "f26aa0d9feeda1216e7d29f56f5bcde12b94dcc4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "007aa220_2dcfaf10",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 7,
      "author": {
        "id": 1014257
      },
      "writtenOn": "2020-06-16T21:44:39Z",
      "side": 1,
      "message": "\u003e \u003e We don\u0027t want to replicate everything at startup.\n\u003e \n\u003e The sentence above is already supported, despite it not being a use case. The currently expressed desire for this knob is the equivalent of \"I just want it to work this way\", but no justification is being provided.\n\u003e \n\u003e A use case is something like: \"I would like any update on my server to get replicated to my remotes\". If this is not working, than there is a bug. The design of the replication plugin requires that you either keep startup replication turned on or that you manually run replication start at some point after a server has been \"downed\". This change does not alter this, it only provides a knob that when turned on will provide the illusion that a broken setup works. I cannot recommend such a knob for community use.\n\u003e \n\nLet me reword this. The use case: \" I would like to have any update on my server to get replicated to my remotes, however I don\u0027t want it to happen all at once on the server startup. It is sufficient for me to wait until new change to the projects will cause those  projects to be replicated. I only want some specific projects to be replicated on startup.\"\n\nBTW, this is a real request from one of our customers.\nWhy do you think it is not a user case?",
      "parentUuid": "23f457ae_d949b01f",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 56
      },
      "revId": "f26aa0d9feeda1216e7d29f56f5bcde12b94dcc4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a8b4bb87_2bbd1ce5",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 7,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-06-16T21:51:01Z",
      "side": 1,
      "message": "\u003e \u003e \u003e We don\u0027t want to replicate everything at startup.\n\u003e \u003e \n\u003e \u003e The sentence above is already supported, despite it not being a use case. The currently expressed desire for this knob is the equivalent of \"I just want it to work this way\", but no justification is being provided.\n\u003e \u003e \n\u003e \u003e A use case is something like: \"I would like any update on my server to get replicated to my remotes\". If this is not working, than there is a bug. The design of the replication plugin requires that you either keep startup replication turned on or that you manually run replication start at some point after a server has been \"downed\". This change does not alter this, it only provides a knob that when turned on will provide the illusion that a broken setup works. I cannot recommend such a knob for community use.\n\u003e \u003e \n\u003e \n\u003e Let me reword this. The use case: \" I would like to have any update on my server to get replicated to my remotes, however I don\u0027t want it to happen all at once on the server startup. It is sufficient for me to wait until new change to the projects will cause those  projects to be replicated. I only want some specific projects to be replicated on startup.\"\n\n+1 to that requirement: we also have customers that have thousands of projects but only a very small set of them are to be replicated at startup. Why? Business decisions and associated workflows.\n\nOf course, if Martin won\u0027t use this feature, he can simply not use it. I don\u0027t believe it would break any existing functionality.",
      "parentUuid": "007aa220_2dcfaf10",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 56
      },
      "revId": "f26aa0d9feeda1216e7d29f56f5bcde12b94dcc4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "df3be39d_0ac3d6e3",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 7,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2020-06-16T21:57:54Z",
      "side": 1,
      "message": "\u003e Let me reword this. The use case: \" I would like to have any update on my server to get replicated to my remotes, however I don\u0027t want it to happen all at once on the server startup. It is sufficient for me to wait until new change to the projects will cause those  projects to be replicated. I only want some specific projects to be replicated on startup.\"\n\nBecause I doubt any customer would say\" do not replicate these projects on startup\" if it were free. In other words, you are expressing a solution not a use case. The desire is to have things replicated with no misses, and I am guessing that you perceive that there are downsides to doing that always for all projects on startup, so you need to express that in your use case. The use case should not express the solution.",
      "parentUuid": "a8b4bb87_2bbd1ce5",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 56
      },
      "revId": "f26aa0d9feeda1216e7d29f56f5bcde12b94dcc4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b43bdace_fccac3f4",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 7,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2020-06-16T22:06:21Z",
      "side": 1,
      "message": "\u003e Why? Business decisions and associated workflows.\n\nIt would be great if you could give us a sample workflow that is functionally inhibited by replicating projects on startup, that would be useful. Currently, the only reason listed to do this is performance/workload issues (which is a real problem!), however that is not a workflow issue, and it can be solved with many solutions, and there are at least 2 changes uploaded that improve this.",
      "parentUuid": "df3be39d_0ac3d6e3",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 56
      },
      "revId": "f26aa0d9feeda1216e7d29f56f5bcde12b94dcc4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a097bd3a_c9e7892a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 7,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-06-16T23:11:10Z",
      "side": 1,
      "message": "\u003e \u003e Why? Business decisions and associated workflows.\n\u003e \n\u003e It would be great if you could give us a sample workflow\n\nOf course I cannot give you the *exact* workflow as it is covered by NDA. A \"sample\" can be the following:\n\n- Project A is the mono-repo that is mostly active across the company: we want that to be 100% aligned across all the sites, otherwise it won\u0027t make any sense for the company to keep on developing its product. Other projects are less critical and it is more important to minimise the startup time and system resources than having them aligned at 100%: we can accept a bit of temporary inconsistency and minimise downtime costs.\n\n\u003e Currently, the only reason listed to do this is performance/workload issues (which is a real problem!)\n\nI gave you a business reason, justified on costs vs. benefits.\n\n\u003e however that is not a workflow issue, and it can be solved with many solutions, and there are at least 2 changes uploaded that improve this.\n\nWhat are the pointers to the changes that enable the selective projects replications at startup?",
      "parentUuid": "b43bdace_fccac3f4",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 56
      },
      "revId": "f26aa0d9feeda1216e7d29f56f5bcde12b94dcc4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "11a25991_426de5ce",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 7,
      "author": {
        "id": 1014257
      },
      "writtenOn": "2022-05-10T10:31:50Z",
      "side": 1,
      "message": "A valid use case for this change is when replication is used solely for CI system purposes. That makes it not so important to replicate everything on the startup. But it is crucial to replicate the latest changes, so that the changes can be verified by CI. And it can only work if we have All-Projects and All-Users replicated at the startup so that permissions and user accounts are set properly.\n\nMartin, do you agree that this is a valid use case, so that we can mark this comment as resolved?",
      "parentUuid": "a097bd3a_c9e7892a",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 56
      },
      "revId": "f26aa0d9feeda1216e7d29f56f5bcde12b94dcc4",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}