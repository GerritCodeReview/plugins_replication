{
  "comments": [
    {
      "key": {
        "uuid": "0849250a_cac88907",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2020-03-30T10:28:29Z",
      "side": 1,
      "message": "\"thread pool\" or just \"queue\"\n\n\"thread queue\" is not a correct term.\nThere is a thread pool which operates on a queue of tasks.",
      "range": {
        "startLine": 7,
        "startChar": 25,
        "endLine": 7,
        "endChar": 37
      },
      "revId": "a48cf30f552b5cc91cb3eb369ea81eaae2dd3628",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8784f3f2_2633b714",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2020-03-30T18:12:40Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "0849250a_cac88907",
      "range": {
        "startLine": 7,
        "startChar": 25,
        "endLine": 7,
        "endChar": 37
      },
      "revId": "a48cf30f552b5cc91cb3eb369ea81eaae2dd3628",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4418ba6f_033a69c5",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2020-03-30T10:28:29Z",
      "side": 1,
      "message": "Is it really scheduling that takes that time?\nOr is it running the push-all task which takes that time?",
      "range": {
        "startLine": 9,
        "startChar": 11,
        "endLine": 9,
        "endChar": 21
      },
      "revId": "a48cf30f552b5cc91cb3eb369ea81eaae2dd3628",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5eeccce4_4f8b2855",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2020-03-30T18:12:40Z",
      "side": 1,
      "message": "It actually was the scheduling based on jstacks I was taking during it.",
      "parentUuid": "4418ba6f_033a69c5",
      "range": {
        "startLine": 9,
        "startChar": 11,
        "endLine": 9,
        "endChar": 21
      },
      "revId": "a48cf30f552b5cc91cb3eb369ea81eaae2dd3628",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "da8fa945_ba5592ad",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2020-03-31T07:45:55Z",
      "side": 1,
      "message": "I would still like to understand how scheduling (and by that\nI mean putting a task in the queue) can take 7 minutes. Can you\nshare more details from your findings?",
      "parentUuid": "5eeccce4_4f8b2855",
      "range": {
        "startLine": 9,
        "startChar": 11,
        "endLine": 9,
        "endChar": 21
      },
      "revId": "a48cf30f552b5cc91cb3eb369ea81eaae2dd3628",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "be630d6e_bb217d69",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 9,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2020-03-31T18:24:50Z",
      "side": 1,
      "message": "It is the push-all task that can take that long, but not to complete the push-all replication, but to put all ~100K task,s that are push all tasks, into the queue. Putting these tasks into the queue requires writing all these tasks to separate tmp files on NFS and then moving them into place one at a time.",
      "parentUuid": "da8fa945_ba5592ad",
      "range": {
        "startLine": 9,
        "startChar": 11,
        "endLine": 9,
        "endChar": 21
      },
      "revId": "a48cf30f552b5cc91cb3eb369ea81eaae2dd3628",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "75f36ba6_bd7a4773",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/PushAll.java",
        "patchSetId": 1
      },
      "lineNbr": 59,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2020-03-30T10:28:29Z",
      "side": 1,
      "message": "The default value of execution.defaultThreadPoolSize is 2 which is the size of the WorkQueue.getDefaultQueue(). Before your change the PushAll tasks were processed with\n(default) two threads and now they will be processed with one thread.\nIs this intentional?",
      "range": {
        "startLine": 59,
        "startChar": 30,
        "endLine": 59,
        "endChar": 31
      },
      "revId": "a48cf30f552b5cc91cb3eb369ea81eaae2dd3628",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "410cc593_2cdc02bb",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/PushAll.java",
        "patchSetId": 1
      },
      "lineNbr": 59,
      "author": {
        "id": 1002666
      },
      "writtenOn": "2020-03-30T18:12:40Z",
      "side": 1,
      "message": "Hmm, no, not quite. We\u0027re actually running this code on 2.7, which 1) doesn\u0027t have a configurable default thread pool size, and 2) only has 1 thread in the default pool.\n\nImagining if we were running on a modern Gerrit, I think we would probably just configure the default thread pool size to be larger. @Martin, do you think we still need this change if we had that?",
      "parentUuid": "75f36ba6_bd7a4773",
      "range": {
        "startLine": 59,
        "startChar": 30,
        "endLine": 59,
        "endChar": 31
      },
      "revId": "a48cf30f552b5cc91cb3eb369ea81eaae2dd3628",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "72bdf2bc_5cba7eb7",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/PushAll.java",
        "patchSetId": 1
      },
      "lineNbr": 59,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2020-03-31T07:45:55Z",
      "side": 1,
      "message": "\u003e Hmm, no, not quite. We\u0027re actually running this code on 2.7, which 1) doesn\u0027t have a configurable default thread pool size, and 2) only has 1 thread in the default pool.\n\nI don\u0027t get this argument. This change is uploaded for stable-2.16 and, I guess,\nall reviewers will be reviewing it with Gerrit 2.16 as the reference.\n\n\u003e \n\u003e Imagining if we were running on a modern Gerrit, I think we would probably just configure the default thread pool size to be larger. @Martin, do you think we still need this change if we had that?",
      "parentUuid": "410cc593_2cdc02bb",
      "range": {
        "startLine": 59,
        "startChar": 30,
        "endLine": 59,
        "endChar": 31
      },
      "revId": "a48cf30f552b5cc91cb3eb369ea81eaae2dd3628",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4136e717_9f489784",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/PushAll.java",
        "patchSetId": 1
      },
      "lineNbr": 59,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2020-03-31T18:35:47Z",
      "side": 1,
      "message": "I don\u0027t think the size of the pool is relevant. I think that what types of tasks are in the pool is what is relevant. I would not want a task that such as replication that will not be lost on restart ever blocking tasks such as running hooks or sending emails that are expected to complete in a more timely manner and would be lost if the server restarts. I would actually recommend that Gerrit have different \"default\" pools for such tasks so that they can still be shared by similar tasks, but be in different pools from the other \"types\" of tasks. I would suggest a \"smallTask\" pool and a \"largeTask\" pool at least, possibly along with \"small/largeRecurringTask\" pools.",
      "parentUuid": "72bdf2bc_5cba7eb7",
      "range": {
        "startLine": 59,
        "startChar": 30,
        "endLine": 59,
        "endChar": 31
      },
      "revId": "a48cf30f552b5cc91cb3eb369ea81eaae2dd3628",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7d9f0fe1_234fe098",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/PushAll.java",
        "patchSetId": 1
      },
      "lineNbr": 59,
      "author": {
        "id": 1003883
      },
      "writtenOn": "2020-03-31T18:39:28Z",
      "side": 1,
      "message": "Perhaps it would make sense to additionally allow admins define the name of the pool to put replication tasks in. This would allow admins to chose a private pool if desired, possibly be defining a pool that they plan to share with some tasks from other plugins even.",
      "parentUuid": "4136e717_9f489784",
      "range": {
        "startLine": 59,
        "startChar": 30,
        "endLine": 59,
        "endChar": 31
      },
      "revId": "a48cf30f552b5cc91cb3eb369ea81eaae2dd3628",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}