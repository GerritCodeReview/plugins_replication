{
  "comments": [
    {
      "key": {
        "uuid": "bf2e49f6_b6408324",
        "filename": "/COMMIT_MSG",
        "patchSetId": 44
      },
      "lineNbr": 13,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-09-17T12:16:33Z",
      "side": 1,
      "message": "Maybe I am missing something (or I forgot something we already discussed) but the newly introduced DestinationsCollection actually\ndepends on a specific ReplicationConfig implementation, namely ReplicationFileBasedConfig?",
      "range": {
        "startLine": 11,
        "startChar": 0,
        "endLine": 13,
        "endChar": 61
      },
      "revId": "f293da48bc6827d07367c7ddbf2ac5cf02a2d9fe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2fe34164_ae18ab0f",
        "filename": "/COMMIT_MSG",
        "patchSetId": 44
      },
      "lineNbr": 13,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-17T13:22:19Z",
      "side": 1,
      "message": "You are right, it should be ReplicationFileBasedConfig.",
      "parentUuid": "bf2e49f6_b6408324",
      "range": {
        "startLine": 11,
        "startChar": 0,
        "endLine": 13,
        "endChar": 61
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "f293da48bc6827d07367c7ddbf2ac5cf02a2d9fe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9f783384_dee174ad",
        "filename": "/COMMIT_MSG",
        "patchSetId": 44
      },
      "lineNbr": 13,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-09-18T13:05:04Z",
      "side": 1,
      "message": "it should or should not?",
      "parentUuid": "2fe34164_ae18ab0f",
      "range": {
        "startLine": 11,
        "startChar": 0,
        "endLine": 13,
        "endChar": 61
      },
      "revId": "f293da48bc6827d07367c7ddbf2ac5cf02a2d9fe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "79f65611_7c952b67",
        "filename": "/COMMIT_MSG",
        "patchSetId": 44
      },
      "lineNbr": 13,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-18T13:57:17Z",
      "side": 1,
      "message": "I have updated the commit message as you spotted: what is code is doing is using the ReplicationFileBasedConfig and not the interface.",
      "parentUuid": "9f783384_dee174ad",
      "range": {
        "startLine": 11,
        "startChar": 0,
        "endLine": 13,
        "endChar": 61
      },
      "revId": "f293da48bc6827d07367c7ddbf2ac5cf02a2d9fe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "08b61719_55fa4268",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/DestinationsCollection.java",
        "patchSetId": 44
      },
      "lineNbr": 61,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-09-17T12:16:33Z",
      "side": 1,
      "message": "Would it be possible to keep the same order of fields here and in the constructor?",
      "revId": "f293da48bc6827d07367c7ddbf2ac5cf02a2d9fe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c20a4d36_9eb2b2d3",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/DestinationsCollection.java",
        "patchSetId": 44
      },
      "lineNbr": 61,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-17T13:22:19Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "08b61719_55fa4268",
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "f293da48bc6827d07367c7ddbf2ac5cf02a2d9fe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4a5d07f7_71cdd507",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/DestinationsCollection.java",
        "patchSetId": 44
      },
      "lineNbr": 82,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-09-17T12:16:33Z",
      "side": 1,
      "message": "This write access to the destinations and the replicationConfig variables is not synchronized.\nHowever, the DestinationCollection singleton will surely be used from multiple threads so\nit needs to be thread-safe.",
      "revId": "f293da48bc6827d07367c7ddbf2ac5cf02a2d9fe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3bba73b0_c795fe27",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/DestinationsCollection.java",
        "patchSetId": 44
      },
      "lineNbr": 82,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-17T13:22:19Z",
      "side": 1,
      "message": "I checked in the code and the access is synchronized: am I missing something?\n\nFor destinations: L174, L180, L253\nFor replicationConfig: L252, L253\n\nWith regards to the shutdown() method, the reason for not being synchronized has been already discussed in the code-base and there is a specific comment explaining why.\n(see L185)\n\nPlease let me know if there is any other synchronization point I\u0027ve missed.",
      "parentUuid": "4a5d07f7_71cdd507",
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "f293da48bc6827d07367c7ddbf2ac5cf02a2d9fe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "206df76f_6a091e7e",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/DestinationsCollection.java",
        "patchSetId": 44
      },
      "lineNbr": 82,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-09-18T13:05:04Z",
      "side": 1,
      "message": "I am referring to exactly this place (line 82). The write to the destinations field\nis not safely published (to other threads), unless my understanding of JMM is wrong about\nthis. See [1] for more details on this topic. It may also be that something changed\nin the JMM (regarding the safe publishing) in recent years and that I am not aware of it.\nIn case you have references to any information which proves that my understanding of JMM\nis outdated please post it here.\n\nHaving said that, making ReplicationFileBasedConfig volatile would finish this discussion :-)\n\n[1] https://stackoverflow.com/a/16788488/11304233",
      "parentUuid": "3bba73b0_c795fe27",
      "revId": "f293da48bc6827d07367c7ddbf2ac5cf02a2d9fe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "dee9a9cb_e033f9e9",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/DestinationsCollection.java",
        "patchSetId": 44
      },
      "lineNbr": 82,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-18T13:57:17Z",
      "side": 1,
      "message": "\u003e I am referring to exactly this place (line 82). The write to the destinations field\n\u003e is not safely published (to other threads), unless my understanding of JMM is wrong about\n\u003e this.\n\nThe destinations instance variable is volatile and the creation is done only once because this class is annotated as a Singleton.\n\n\u003e See [1] for more details on this topic. It may also be that something changed\n\u003e in the JMM (regarding the safe publishing) in recent years and that I am not aware of it.\n\u003e In case you have references to any information which proves that my understanding of JMM\n\u003e is outdated please post it here.\n\nIn [1] there is this statement:\n\"For volatile variables, writes are guaranteed to be immediately visible to all threads. This is the case whether or not the write was done in a constructor.\"\n\nThe volatile variable is thus published to be immediately visible to all threads.\n\n\u003e Having said that, making ReplicationFileBasedConfig volatile would finish this discussion :-)\n\u003e \n\u003e [1] https://stackoverflow.com/a/16788488/11304233\n\nI have done it in P49 already :-)",
      "parentUuid": "206df76f_6a091e7e",
      "revId": "f293da48bc6827d07367c7ddbf2ac5cf02a2d9fe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9b10e167_182cb160",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/DestinationsCollection.java",
        "patchSetId": 44
      },
      "lineNbr": 82,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-09-18T15:08:42Z",
      "side": 1,
      "message": "Oh sorry... I meant replicationConfig, not destinations.\nLet\u0027s continue in the latest PS.",
      "parentUuid": "dee9a9cb_e033f9e9",
      "revId": "f293da48bc6827d07367c7ddbf2ac5cf02a2d9fe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a93edef3_caa54cc4",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/DestinationsCollection.java",
        "patchSetId": 44
      },
      "lineNbr": 82,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-18T15:10:43Z",
      "side": 1,
      "message": "\u003e Oh sorry... I meant replicationConfig, not destinations.\n\u003e Let\u0027s continue in the latest PS.\n\nGotcha, yes you are right. DavidO found it already and it\u0027s fixed in PS50.",
      "parentUuid": "9b10e167_182cb160",
      "revId": "f293da48bc6827d07367c7ddbf2ac5cf02a2d9fe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9b9f97dd_39881557",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/DestinationsCollection.java",
        "patchSetId": 44
      },
      "lineNbr": 150,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-09-17T12:16:33Z",
      "side": 1,
      "message": "I think we do not use comments like these in Gerrit\u0027s source code?",
      "range": {
        "startLine": 145,
        "startChar": 0,
        "endLine": 150,
        "endChar": 5
      },
      "revId": "f293da48bc6827d07367c7ddbf2ac5cf02a2d9fe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fed7491e_ce13351e",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/DestinationsCollection.java",
        "patchSetId": 44
      },
      "lineNbr": 150,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-09-17T12:16:33Z",
      "side": 1,
      "message": "remove?",
      "range": {
        "startLine": 145,
        "startChar": 0,
        "endLine": 150,
        "endChar": 5
      },
      "revId": "f293da48bc6827d07367c7ddbf2ac5cf02a2d9fe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3fe9ea5f_cb0b2ead",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/DestinationsCollection.java",
        "patchSetId": 44
      },
      "lineNbr": 150,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-17T13:22:19Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9b9f97dd_39881557",
      "range": {
        "startLine": 145,
        "startChar": 0,
        "endLine": 150,
        "endChar": 5
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "f293da48bc6827d07367c7ddbf2ac5cf02a2d9fe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b2f9fec6_bafb4240",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/DestinationsCollection.java",
        "patchSetId": 44
      },
      "lineNbr": 150,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-17T13:22:19Z",
      "side": 1,
      "message": "Yes, it has been automatically generated. Done.",
      "parentUuid": "fed7491e_ce13351e",
      "range": {
        "startLine": 145,
        "startChar": 0,
        "endLine": 150,
        "endChar": 5
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "f293da48bc6827d07367c7ddbf2ac5cf02a2d9fe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "dfa8ccb3_ce02b40d",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/DestinationsCollection.java",
        "patchSetId": 44
      },
      "lineNbr": 171,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-09-17T12:16:33Z",
      "side": 1,
      "message": "remove?",
      "range": {
        "startLine": 169,
        "startChar": 0,
        "endLine": 171,
        "endChar": 5
      },
      "revId": "f293da48bc6827d07367c7ddbf2ac5cf02a2d9fe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c62472bc_d52ba1a3",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/DestinationsCollection.java",
        "patchSetId": 44
      },
      "lineNbr": 171,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-17T13:22:19Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "dfa8ccb3_ce02b40d",
      "range": {
        "startLine": 169,
        "startChar": 0,
        "endLine": 171,
        "endChar": 5
      },
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "f293da48bc6827d07367c7ddbf2ac5cf02a2d9fe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "95064240_440debbc",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/DestinationsCollection.java",
        "patchSetId": 44
      },
      "lineNbr": 185,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-09-17T12:16:33Z",
      "side": 1,
      "message": "Should this be a javadoc comment?",
      "revId": "f293da48bc6827d07367c7ddbf2ac5cf02a2d9fe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f0b4cc79_951ae8e0",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/DestinationsCollection.java",
        "patchSetId": 44
      },
      "lineNbr": 185,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-17T13:22:19Z",
      "side": 1,
      "message": "It is not the documentation of the method API but rather a warning explaining why it was not synchronized.\nIt has been copy\u0026pasted from existing code and wasn\u0027t JavaDoc before.",
      "parentUuid": "95064240_440debbc",
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "f293da48bc6827d07367c7ddbf2ac5cf02a2d9fe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a00a97e3_e93a90c4",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/DestinationsCollection.java",
        "patchSetId": 44
      },
      "lineNbr": 203,
      "author": {
        "id": 1003873
      },
      "writtenOn": "2019-09-17T12:16:33Z",
      "side": 1,
      "message": "This access to destinations is also not synchronized",
      "revId": "f293da48bc6827d07367c7ddbf2ac5cf02a2d9fe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "66467f8b_d3f43a6e",
        "filename": "src/main/java/com/googlesource/gerrit/plugins/replication/DestinationsCollection.java",
        "patchSetId": 44
      },
      "lineNbr": 203,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2019-09-17T13:22:19Z",
      "side": 1,
      "message": "The comment is explaining it why.\nAdditionally, the destinations variable is overwritten only during reload and, the reload thread is getting cancelled before starting the shutdown sequence.\n\nThis code is coming from existing merged code and this has been already discussed and accepted. Did we miss anything in the previous review?",
      "parentUuid": "a00a97e3_e93a90c4",
      "tag": "autogenerated:gerrit:newPatchSet",
      "revId": "f293da48bc6827d07367c7ddbf2ac5cf02a2d9fe",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}